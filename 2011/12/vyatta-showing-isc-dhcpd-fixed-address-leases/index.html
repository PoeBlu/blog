<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>Vyatta - Showing ISC dhcpd fixed-address leases</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Open Graph tags -->

    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://blog.jasonantman.com/theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="http://blog.jasonantman.com/theme/css/font-awesome.min.css" rel="stylesheet">
    <link href="http://blog.jasonantman.com/theme/css/pygments.css" rel="stylesheet">
        <link href="http://blog.jasonantman.com/theme/css/typogrify.css" rel="stylesheet">
    <link rel="stylesheet" href="http://blog.jasonantman.com/theme/css/style.css" type="text/css"/>
    <!-- JavaScript plugins (requires jQuery) -->
    <script src="http://code.jquery.com/jquery.js"></script>

    <link rel="stylesheet" href="http://blog.jasonantman.com/theme/css/forkongithub.min.css" type="text/css" />

        <link href="http://blog.jasonantman.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Jason Antman's Blog ATOM Feed"/>
        <link href="http://blog.jasonantman.com/feeds/all.rss.xml" type="application/atom+xml" rel="alternate"
              title="Jason Antman's Blog RSS Feed"/>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2718127-2', 'jasonantman.com');
  ga('send', 'pageview');

</script>
</head>
<body>
<span id="forkongithub"><a href="https://github.com/jantman/blog">Fork me on GitHub</a></span><nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://blog.jasonantman.com" class="navbar-brand">Jason Antman's Blog</a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="http://blog.jasonantman.com/pages/about.html">
                             About
                          </a></li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/ideas-and-rants/index.html">Ideas and rants</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/miscellaneous/index.html">Miscellaneous</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/monitoring/index.html">Monitoring</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/ops/index.html">Ops</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/projects/index.html">Projects</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/puppet/index.html">Puppet</a>
                        </li>
                        <li class="active">
                            <a href="http://blog.jasonantman.com/categories/tech-howtos/index.html">Tech howtos</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://blog.jasonantman.com/archives.html"><i class="icon-th-list"></i>Archives</a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</nav>
<!-- /.navbar -->
<div class="container">
    <div class="row">
        <div class="col-lg-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://blog.jasonantman.com/2011/12/vyatta-showing-isc-dhcpd-fixed-address-leases/"
                       rel="bookmark"
                       title="Permalink to Vyatta - Showing ISC dhcpd fixed-address leases">
                        Vyatta - Showing <span class="caps">ISC</span> dhcpd fixed-address&nbsp;leases
                    </a>
                </h1>
<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="j_antman">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="icon-calendar"></i>Sat 24 December 2011
    </span>



<span class="label label-default">Tags</span>
	<a href="http://blog.jasonantman.com/tags/dhcpd/index.html">dhcpd</a>
        /
	<a href="http://blog.jasonantman.com/tags/rsyslog/index.html">rsyslog</a>
        /
	<a href="http://blog.jasonantman.com/tags/vyatta/index.html">vyatta</a>
</footer><!-- /.post-info -->                    </div>
                </div>
                <p><span class="caps">ISC</span> <a href="http://www.isc.org/software/dhcp">dhcpd</a> has the ability to always
give a specific <span class="caps">MAC</span> address the same <span class="caps">IP</span> address &#8220;lease&#8221; using the
fixed-address configuration option. This is configured in
<a href="http://www.vyatta.org">Vyatta</a> using the <code>static-mapping</code> configuration
statement. Unfortunately, since dhcpd doesn&#8217;t store fixed-address leases
in the <code>dhcpd.leases</code> file, the Vyatta <code>show dhcp leases</code> command
doesn&#8217;t show anything about them - which makes it difficult to debug
anything dhcp-related if all of the hosts on your network are setup for
fixed addresses. I found a mention of this on the <a href="http://www.vyatta.org/forum/viewtopic.php?p=121558">vyatta
forum</a>, and also an
<a href="https://bugzilla.vyatta.com/show_bug.cgi?id=1990">open bug (1990)</a> to
fix it, but no proposed resolution. Since I came across this problem and
happen to know a bit about <span class="caps">ISC</span> dhcpd, I developed both a workaround for
users (including a perl script) and a possible solution for the Vyatta
developers to&nbsp;implement.</p>
<p><strong>Workaround for&nbsp;Users:</strong></p>
<p>There&#8217;s no way to get dhcpd to store fixed-address hosts in the
dhcpd.leases file (though it&#8217;s been discussed on the dhcpd-users mailing
list a few times). There is, however, a way to get dhcpd to log every
time it sends an <span class="caps">ACK</span> to a client. The following Vyatta configuration
commands will get dhcpd to log all transactions to syslog, will have
<a href="http://rsyslog.com/">rsyslog</a> put that in <code>/var/log/user/dhcpd</code>. Since
this log can fill up very quickly on a busy server, the latter two
commands will tell <a href="https://fedorahosted.org/logrotate/">logrotate</a> to
rotate the log file when it reaches 3000k in size, and keep 5 copies
(feel free to adjust to your&nbsp;needs):</p>
<div class="codehilite"><pre><span class="gp">#</span> <span class="nb">set </span>service dhcp-server global-parameters <span class="s2">&quot;log-facility local2;&quot;</span>
<span class="gp">#</span> <span class="nb">set </span>system syslog file dhcpd facility local2 level debug
<span class="gp">#</span> <span class="nb">set </span>system syslog file dhcpd archive files 5
<span class="gp">#</span> <span class="nb">set </span>system syslog file dhcpd archive size 3000
</pre></div>


<p>Once this is done, you can <code>tail -f /var/log/user/dhcpd</code> to watch <span class="caps">DHCP</span>
discover/request/offer/ack in realtime, or grep through the log file for
a specific <span class="caps">IP</span> or <span class="caps">MAC</span>. If you want an easier method, I&#8217;ve written a perl
script (latest version will always live in <a href="https://github.com/jantman/misc-scripts/blob/master/show_dhcp_fixed_ACKs.pl">my GitHub misc-scripts
repo</a>)
to grep through <code>/var/log/user/dhcpd</code> and show the most recent <span class="caps">DHCPACK</span>
for each <span class="caps">IP</span> address, sorted by <span class="caps">IP</span>. Here&#8217;s the code of the simple script,
which is more than half comments. To use it, after performing the above
steps, all you need to do is login to your Vyatta box,
<code>wget https://raw.github.com/jantman/misc-scripts/master/show_dhcp_fixed_ACKs.pl</code>
and then <code>perl show_dhcp_fixed_ACKs.pl</code>.</p>
<div class="codehilite"><pre><span class="c1">#!/usr/bin/perl</span>

<span class="c1">#</span>
<span class="c1"># show_dhcp_fixed_ACKs.pl - script to show the most recent <span class="caps">DHCP</span> ACKs per <span class="caps">IP</span> address for <span class="caps">ISC</span> DHCPd,</span>
<span class="c1">#   from a log file. Originally written for Vyatta routers that just show the dynamic leases.</span>
<span class="c1">#</span>
<span class="c1"># To use this, you need to have dhcpd logging to syslog, and your syslog server putting the log file at</span>
<span class="c1"># /var/log/user/dhcpd (or a file path specified by the $logfile variable below.</span>
<span class="c1">#</span>
<span class="c1"># To accomplish this on Vyatta 6.3, run:</span>
<span class="c1"># set service dhcp-server global-parameters &quot;log-facility local2;&quot;</span>
<span class="c1"># set system syslog file dhcpd facility local2 level debug</span>
<span class="c1"># set system syslog file dhcpd archive files 5</span>
<span class="c1"># set system syslog file dhcpd archive size 3000</span>
<span class="c1"># commit</span>
<span class="c1">#</span>
<span class="c1"># Copyright 2011 Jason Antman  All Rights Reserved.</span>
<span class="c1"># This script is free for use by anyone anywhere, provided that you comply with the following terms:</span>
<span class="c1"># 1) Keep this notice and copyright statement intact.</span>
<span class="c1"># 2) Send any substantial changes, improvements or bog fixes back to me at the above address.</span>
<span class="c1"># 3) If you include this in a product or redistribute it, you notify me, and include my name in the credits or changelog.</span>
<span class="c1">#</span>
<span class="c1"># The following <span class="caps">URL</span> always points to the newest version of this script. If you obtained it from another source, you should</span>
<span class="c1"># check here:</span>
<span class="c1"># $HeadURL$</span>
<span class="c1"># $LastChangedRevision$</span>
<span class="c1">#</span>
<span class="c1"># <span class="caps">CHANGELOG</span>:</span>
<span class="c1"># 2011-12-24 jason@jasonantman.com:</span>
<span class="c1">#    initial version of script</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$logfile</span> <span class="o">=</span> <span class="s">&quot;/var/log/user/dhcpd&quot;</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">%data</span> <span class="o">=</span> <span class="p">();</span>

<span class="nb">open</span> <span class="n"><span class="caps">DF</span></span><span class="p">,</span> <span class="nv">$logfile</span> <span class="ow">or</span> <span class="nb">die</span> <span class="vg">$!</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span> <span class="k">my</span> <span class="nv">$line</span> <span class="o">=</span>  <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nv">$line</span> <span class="o">!~</span> <span class="sr">m/dhcpd: <span class="caps">DHCPACK</span>/</span><span class="p">)</span> <span class="p">{</span> <span class="k">next</span><span class="p">;}</span>
    <span class="nv">$line</span> <span class="o">=~</span> <span class="sr">m/([A-Za-z]+ [0-9]+ [0-9]{1,2}:[0-9]{2}:[0-9]{2}) [^\/x]+ dhcpd: <span class="caps">DHCPACK</span> on (\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}) to ((?:[0-9a-f]{2}[:-]){5}[0-9a-f]{2}) via (.+)/</span><span class="p">;</span>
    <span class="c1">#print &quot;$1==$2==$3==$4==\n&quot; ;</span>
    <span class="nv">$data</span><span class="p">{</span><span class="s">&quot;$2&quot;</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="s">&#39;mac&#39;</span><span class="p">}</span> <span class="o">=</span> <span class="s">&quot;$3&quot;</span><span class="p">;</span>
    <span class="nv">$data</span><span class="p">{</span><span class="s">&quot;$2&quot;</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="s">&#39;date&#39;</span><span class="p">}</span> <span class="o">=</span> <span class="s">&quot;$1&quot;</span><span class="p">;</span>
    <span class="nv">$data</span><span class="p">{</span><span class="s">&quot;$2&quot;</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="s">&#39;if&#39;</span><span class="p">}</span> <span class="o">=</span> <span class="s">&quot;$4&quot;</span><span class="p">;</span>
    <span class="nv">$data</span><span class="p">{</span><span class="s">&quot;$2&quot;</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="s">&#39;ip&#39;</span><span class="p">}</span> <span class="o">=</span> <span class="s">&quot;$2&quot;</span><span class="p">;</span>    
<span class="p">}</span>

<span class="nb">printf</span><span class="p">(</span><span class="s">&quot;%-18s %-20s %-18s %-10s\n&quot;</span><span class="p">,</span> <span class="s">&quot;<span class="caps">IP</span> Address&quot;</span><span class="p">,</span> <span class="s">&quot;Hardware Address&quot;</span><span class="p">,</span> <span class="s">&quot;Date&quot;</span><span class="p">,</span> <span class="s">&quot;Interface&quot;</span><span class="p">);</span>
<span class="nb">printf</span><span class="p">(</span><span class="s">&quot;%-18s %-20s %-18s %-10s\n&quot;</span><span class="p">,</span> <span class="s">&quot;----------&quot;</span><span class="p">,</span> <span class="s">&quot;----------------&quot;</span><span class="p">,</span> <span class="s">&quot;----&quot;</span><span class="p">,</span> <span class="s">&quot;---------&quot;</span><span class="p">);</span>

<span class="c1"># begin sort by <span class="caps">IP</span> address</span>
<span class="k">my</span> <span class="nv">@keys</span> <span class="o">=</span>
  <span class="nb">map</span>  <span class="nb">substr</span><span class="p">(</span><span class="nv">$_</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="nb">sort</span>
  <span class="nb">map</span>  <span class="nb">pack</span><span class="p">(</span><span class="s">&#39;C4&#39;</span> <span class="o">=&gt;</span>
    <span class="sr">/(\d+)\.(\d+)\.(\d+)\.(\d+)/</span><span class="p">)</span>
    <span class="o">.</span> <span class="nv">$_</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nb">keys</span> <span class="nv">%data</span><span class="p">);</span>
<span class="c1"># end sort by <span class="caps">IP</span> address</span>

<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$key</span> <span class="p">(</span><span class="nv">@keys</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">printf</span><span class="p">(</span><span class="s">&quot;%-18s %-20s %-18s %-10s\n&quot;</span><span class="p">,</span> <span class="nv">$data</span><span class="p">{</span><span class="nv">$key</span><span class="p">}{</span><span class="s">&#39;ip&#39;</span><span class="p">},</span> <span class="nv">$data</span><span class="p">{</span><span class="nv">$key</span><span class="p">}{</span><span class="s">&#39;mac&#39;</span><span class="p">},</span> <span class="nv">$data</span><span class="p">{</span><span class="nv">$key</span><span class="p">}{</span><span class="s">&#39;date&#39;</span><span class="p">},</span> <span class="nv">$data</span><span class="p">{</span><span class="nv">$key</span><span class="p">}{</span><span class="s">&#39;if&#39;</span><span class="p">});</span>
<span class="p">}</span>
</pre></div>


<p><strong>A solution for&nbsp;Vyatta:</strong></p>
<p>I suggested this to Vyatta in a reply to <a href="https://bugzilla.vyatta.com/show_bug.cgi?id=1990">bug
1990</a>. Since they
already use <a href="http://rsyslog.com/">rsyslog</a> which has very powerful
processing capabilities, it would be easy to have rsyslog parse the
<span class="caps">DHCPACK</span> messages in real time and update some data store (flat files or
a simple database) with the information. While how to store this would
be up to the Vyatta guys, I have some rsyslog configuration to parse
<span class="caps">DHCPACK</span> messages and update a MySQL database (with two tables; one for
most recent <span class="caps">ACK</span> per <span class="caps">IP</span> address and one for most recent <span class="caps">ACK</span> per <span class="caps">MAC</span>
address) that might be of some&nbsp;use:</p>
<div class="codehilite"><pre>$template DHCPACKonIP, &quot;INSERT INTO dhcplog_ip   
       SET   
       server_ip=inet_aton(&#39;%fromhost-ip%&#39;),   
       msg_type=&#39;DHCPACK&#39;,   
       date=&#39;%timereported:::date-mysql%&#39;,   
       mac_addr=&#39;%msg:R,ERE,2,BLANK:DHCPACK on ([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}) to (([0-9a-f]{2}:){5}[0-9a-f]{2})( \(([^)]+)\))? via (([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})|eth0)--end%&#39;,   
       client_ip=inet_aton(&#39;%msg:R,ERE,1,BLANK:DHCPACK on ([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}) to (([0-9a-f]{2}:){5}[0-9a-f]{2})( \(([^)]+)\))? via (([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})|eth0)--end%&#39;),   
       gateway=&#39;%msg:R,ERE,6,BLANK:DHCPACK on ([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}) to (([0-9a-f]{2}:){5}[0-9a-f]{2})( \(([^)]+)\))? via (([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})|eth0)--end%&#39;,   
       fullmsg=&#39;%msg%&#39;   
       ON DUPLICATE KEY UPDATE   
       server_ip=inet_aton(&#39;%fromhost-ip%&#39;),   
       date=&#39;%timereported:::date-mysql%&#39;,   
       mac_addr=&#39;%msg:R,ERE,2,BLANK:DHCPACK on ([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}) to (([0-9a-f]{2}:){5}[0-9a-f]{2})( \(([^)]+)\))? via (([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})|eth0)--end%&#39;,   
       gateway=&#39;%msg:R,ERE,6,BLANK:DHCPACK on ([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}) to (([0-9a-f]{2}:){5}[0-9a-f]{2})( \(([^)]+)\))? via (([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})|eth0)--end%&#39;,   
       fullmsg=&#39;%msg%&#39;  
&quot;,SQL

$template DHCPACKonMAC, &quot;INSERT INTO dhcplog_mac   
       SET   
       server_ip=inet_aton(&#39;%fromhost-ip%&#39;),   
       msg_type=&#39;DHCPACK&#39;,   
       date=&#39;%timereported:::date-mysql%&#39;,   
       mac_addr=&#39;%msg:R,ERE,2,BLANK:DHCPACK on ([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}) to (([0-9a-f]{2}:){5}[0-9a-f]{2})( \(([^)]+)\))? via (([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})|eth0)--end%&#39;,   
       client_ip=inet_aton(&#39;%msg:R,ERE,1,BLANK:DHCPACK on ([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}) to (([0-9a-f]{2}:){5}[0-9a-f]{2})( \(([^)]+)\))? via (([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})|eth0)--end%&#39;),   
       gateway=&#39;%msg:R,ERE,6,BLANK:DHCPACK on ([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}) to (([0-9a-f]{2}:){5}[0-9a-f]{2})( \(([^)]+)\))? via (([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})|eth0)--end%&#39;,   
       fullmsg=&#39;%msg%&#39;   
       ON DUPLICATE KEY UPDATE   
       server_ip=inet_aton(&#39;%fromhost-ip%&#39;),   
       date=&#39;%timereported:::date-mysql%&#39;,   
       client_ip=inet_aton(&#39;%msg:R,ERE,1,BLANK:DHCPACK on ([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}) to (([0-9a-f]{2}:){5}[0-9a-f]{2})( \(([^)]+)\))? via (([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})|eth0)--end%&#39;),   
       gateway=&#39;%msg:R,ERE,6,BLANK:DHCPACK on ([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}) to (([0-9a-f]{2}:){5}[0-9a-f]{2})( \(([^)]+)\))? via (([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})|eth0)--end%&#39;,   
       fullmsg=&#39;%msg%&#39;  
&quot;,SQL

$template DHCPACKtoIP, &quot;INSERT INTO dhcplog_ip   
       SET   
       server_ip=inet_aton(&#39;%fromhost-ip%&#39;),   
       msg_type=&#39;DHCPACK&#39;,   
       date=&#39;%timereported:::date-mysql%&#39;,   
       mac_addr=&#39;%msg:R,ERE,2,BLANK:DHCPACK to ([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}) \((([0-9a-f]{2}:){5}[0-9a-f]{2})\) via (([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})|eth0)--end%&#39;,   
       client_ip=inet_aton(&#39;%msg:R,ERE,1,BLANK:DHCPACK to ([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}) \((([0-9a-f]{2}:){5}[0-9a-f]{2})\) via (([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})|eth0)--end%&#39;),   
       gateway=&#39;%msg:R,ERE,4,BLANK:DHCPACK to ([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}) \((([0-9a-f]{2}:){5}[0-9a-f]{2})\) via (([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})|eth0)--end%&#39;,   
       fullmsg=&#39;%msg%&#39;   
       ON DUPLICATE KEY UPDATE   
       server_ip=inet_aton(&#39;%fromhost-ip%&#39;),   
       date=&#39;%timereported:::date-mysql%&#39;,   
       mac_addr=&#39;%msg:R,ERE,2,BLANK:DHCPACK to ([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}) \((([0-9a-f]{2}:){5}[0-9a-f]{2})\) via (([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})|eth0)--end%&#39;,   
       gateway=&#39;%msg:R,ERE,4,BLANK:DHCPACK to ([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}) \((([0-9a-f]{2}:){5}[0-9a-f]{2})\) via (([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})|eth0)--end%&#39;,   
       fullmsg=&#39;%msg%&#39;  
&quot;,SQL

$template DHCPACKtoMAC, &quot;INSERT INTO dhcplog_mac   
       SET   
       server_ip=inet_aton(&#39;%fromhost-ip%&#39;),   
       msg_type=&#39;DHCPACK&#39;,   
       date=&#39;%timereported:::date-mysql%&#39;,   
       mac_addr=&#39;%msg:R,ERE,2,BLANK:DHCPACK to ([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}) \((([0-9a-f]{2}:){5}[0-9a-f]{2})\) via (([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})|eth0)--end%&#39;,   
       client_ip=inet_aton(&#39;%msg:R,ERE,1,BLANK:DHCPACK to ([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}) \((([0-9a-f]{2}:){5}[0-9a-f]{2})\) via (([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})|eth0)--end%&#39;),   
       gateway=&#39;%msg:R,ERE,4,BLANK:DHCPACK to ([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}) \((([0-9a-f]{2}:){5}[0-9a-f]{2})\) via (([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})|eth0)--end%&#39;,   
       fullmsg=&#39;%msg%&#39;   
       ON DUPLICATE KEY UPDATE   
       server_ip=inet_aton(&#39;%fromhost-ip%&#39;),   
       date=&#39;%timereported:::date-mysql%&#39;,   
       client_ip=inet_aton(&#39;%msg:R,ERE,1,BLANK:DHCPACK to ([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}) \((([0-9a-f]{2}:){5}[0-9a-f]{2})\) via (([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})|eth0)--end%&#39;),   
       gateway=&#39;%msg:R,ERE,4,BLANK:DHCPACK to ([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}) \((([0-9a-f]{2}:){5}[0-9a-f]{2})\) via (([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})|eth0)--end%&#39;,   
       fullmsg=&#39;%msg%&#39;  
&quot;,SQL

:msg, startswith, &quot; DHCPACK on&quot; :ommysql:hostname,database,dbuser,dbpass;DHCPACKonIP
<span class="amp">&amp;</span> :ommysql:hostname,database,dbuser,dbpass;DHCPACKonMAC
<span class="amp">&amp;</span> ~ ### <span class="caps">DISCARD</span>

if $msg startswith &#39; <span class="caps">DHCPACK</span> to&#39; and ( not ( $msg contains &#39;no client hardware address&#39; ) )   
then :ommysql:hostname,database,dbuser,dbpass;DHCPACKtoMAC
<span class="amp">&amp;</span> :ommysql:hostname,database,dbuser,dbpass;DHCPACKtoIP
<span class="amp">&amp;</span> ~ ### <span class="caps">DISCARD</span>
</pre></div>
            </div>
            <!-- /.entry-content -->
    <hr />
    <section class="comments" id="comments">
        <h2>Comments</h2>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'jantman'; // required: replace example with your forum shortname
            var disqus_identifier = 'vyatta-showing-isc-dhcpd-fixed-address-leases';
            var disqus_url = 'http://blog.jasonantman.com/2011/12/vyatta-showing-isc-dhcpd-fixed-address-leases/';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-lg-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">

                <li class="list-group-item"><h4><i class="icon-home icon-large"></i>Recent Posts</h4></li>
                        <li class="list-group-item">
                            <a href="http://blog.jasonantman.com/2014/07/bashrc-vagrant-virtualbox-reminder/">
                                bashrc Vagrant / VirtualBox&nbsp;reminder
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://blog.jasonantman.com/2014/05/remotely-controlled-deckjs-slide-presentations/">
                                Remotely-controlled deck.js slide&nbsp;presentations
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://blog.jasonantman.com/2014/05/dashsnap-a-script-to-snapshot-a-graphite-dashboard/">
                                dashsnap.py - A Script to Snapshot a Graphite&nbsp;Dashboard
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://blog.jasonantman.com/2014/03/nsa-targeting-sysadmins/">
                                <span class="caps">NSA</span> Targeting&nbsp;SysAdmins
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://blog.jasonantman.com/2014/03/python-script-to-backup-disqus-comments/">
                                Python script to backup Disqus&nbsp;comments
                            </a>
                        </li>


                <li class="list-group-item"><a href="http://blog.jasonantman.com/tags.html"><h4><i class="icon-tags icon-large"></i>Tags</h4></a></li>
                <li class="list-group-item">
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/linux/index.html">
                                linux
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/microsoft/index.html">
                                microsoft
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/monitoring/index.html">
                                monitoring
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/blog/index.html">
                                blog
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/php/index.html">
                                PHP
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/android/index.html">
                                android
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/security/index.html">
                                security
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/wordpress/index.html">
                                wordpress
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/google/index.html">
                                google
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/sun/index.html">
                                sun
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/sysadmin/index.html">
                                sysadmin
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/nagios/index.html">
                                Nagios
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/puppet/index.html">
                                puppet
                            </a>
                        </span>
                        <span class="tag-2">
                            <a href="http://blog.jasonantman.com/tags/firefox/index.html">
                                firefox
                            </a>
                        </span>
                        <span class="tag-2">
                            <a href="http://blog.jasonantman.com/tags/syslog/index.html">
                                syslog
                            </a>
                        </span>
                        <span class="tag-2">
                            <a href="http://blog.jasonantman.com/tags/dns/index.html">
                                dns
                            </a>
                        </span>
                        <span class="tag-2">
                            <a href="http://blog.jasonantman.com/tags/droid/index.html">
                                droid
                            </a>
                        </span>
                        <span class="tag-2">
                            <a href="http://blog.jasonantman.com/tags/apache/index.html">
                                apache
                            </a>
                        </span>
                        <span class="tag-2">
                            <a href="http://blog.jasonantman.com/tags/mediawiki/index.html">
                                mediawiki
                            </a>
                        </span>
                        <span class="tag-2">
                            <a href="http://blog.jasonantman.com/tags/logging/index.html">
                                logging
                            </a>
                        </span>
                </li>
        </ul>
    </section>
    <section>
    <ul class="list-group list-group-flush">
    <li class="list-group-item" style="padding: 10px 15px 0px 15px;"><h4><i class="icon-twitter
    icon-large"></i>Twitter <a href="https://twitter.com/j_antman"
    class="twitter-follow-button" data-show-count="false"
    data-dnt="true">Follow @j_antman</a></h4>
<script>!function(d,s,id){var
  js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document,
  'script', 'twitter-wjs');</script></li>
    </ul>
    <a class="twitter-timeline" data-dnt="true"
    href="https://twitter.com/j_antman"
    data-chrome="transparent noheader" data-widget-id="429640274453594113">Tweets by @j_antman</a>
    <script>!function(d,s,id){var
    js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </section>
    <section>
    <ul class="list-group list-group-flush">
    <li class="list-group-item"><h4><i class="icon-github icon-large"></i>GitHub Repos</h4></li>
        <div id="gh_repos">
            <p class="list-group-item">Status updating...</p>
        </div>
            <a href="https://github.com/jantman">@jantman</a> on GitHub
    </ul>
        <script type="text/javascript">
            $(document).ready(function () {
                if (!window.jXHR) {
                    var jxhr = document.createElement('script');
                    jxhr.type = 'text/javascript';
                    jxhr.src = 'http://blog.jasonantman.com/theme/js/jXHR.js';
                    var s = document.getElementsByTagName('script')[0];
                    s.parentNode.insertBefore(jxhr, s);
                }

                github.showRepos({
                    user: 'jantman',
                    count: 5,
                    skip_forks: false,
                    target: '#gh_repos'
                });
            });
        </script>
        <script src="http://blog.jasonantman.com/theme/js/github.js" type="text/javascript"></script>
    </section>
</aside>        </div>
    </div>
</div>
<footer>
    <div class="container">
        <hr>
        <p class="pull-right"><i class="icon-arrow-up"></i> <a href="#">Back to top</a></p>


        <p>&copy; 2014 Jason Antman &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a></p>
    </div>
</footer>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://blog.jasonantman.com/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://blog.jasonantman.com/theme/js/respond.min.js"></script>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'jantman'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>


</body>
</html>