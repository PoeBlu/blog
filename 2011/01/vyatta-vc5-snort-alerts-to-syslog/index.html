<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>Vyatta VC5 - Snort alerts to syslog</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Open Graph tags -->

            <meta property="og:type" content="article"/>
            <meta property="og:title" content="Vyatta VC5 - Snort alerts to syslog"/>
            <meta property="og:url" content="http://jantman.github.io/blog/2011/01/vyatta-vc5-snort-alerts-to-syslog/"/>
            <meta property="og:description" content="I’m running a Vyatta vyatta router at home - in my opinion it’s pretty near “enterprise grade”, and I’m running the Community/Core (read: no-cost and almost all Free) on commodity hardware with great performance. Granted, I’m still on the older version (5 as opposed to the ..."/>

    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://jantman.github.io/blog/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://jantman.github.io/blog/theme/css/font-awesome.min.css" rel="stylesheet">
    <link href="http://jantman.github.io/blog/theme/css/pygments.css" rel="stylesheet">
        <link href="http://jantman.github.io/blog/theme/css/typogrify.css" rel="stylesheet">
    <link rel="stylesheet" href="http://jantman.github.io/blog/theme/css/style.css" type="text/css"/>
    <!-- JavaScript plugins (requires jQuery) -->
    <script src="http://code.jquery.com/jquery.js"></script>


</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://jantman.github.io/blog" class="navbar-brand">Jason Antman's Blog</a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="http://jantman.github.io/blog/pages/about.html">
                             About
                          </a></li>
                        <li >
                            <a href="http://jantman.github.io/blog/category/ideas-and-rants.html">Ideas and rants</a>
                        </li>
                        <li >
                            <a href="http://jantman.github.io/blog/category/miscellaneous.html">Miscellaneous</a>
                        </li>
                        <li >
                            <a href="http://jantman.github.io/blog/category/monitoring.html">Monitoring</a>
                        </li>
                        <li >
                            <a href="http://jantman.github.io/blog/category/projects.html">Projects</a>
                        </li>
                        <li >
                            <a href="http://jantman.github.io/blog/category/puppet.html">Puppet</a>
                        </li>
                        <li >
                            <a href="http://jantman.github.io/blog/category/sysadmin.html">Sysadmin</a>
                        </li>
                        <li class="active">
                            <a href="http://jantman.github.io/blog/category/tech-howtos.html">Tech howtos</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://jantman.github.io/blog/archives.html"><i class="icon-th-list"></i>Archives</a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</nav>
<!-- /.navbar -->
<div class="container">
    <div class="row">
        <div class="col-lg-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://jantman.github.io/blog/2011/01/vyatta-vc5-snort-alerts-to-syslog/"
                       rel="bookmark"
                       title="Permalink to Vyatta VC5 - Snort alerts to syslog">
                        Vyatta <span class="caps">VC5</span> - Snort alerts to&nbsp;syslog
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="icon-calendar"></i>Sun 30 January 2011
    </span>



<span class="label label-default">Tags</span>
	<a href="http://jantman.github.io/blog/tag/security.html">security</a>
        /
	<a href="http://jantman.github.io/blog/tag/snort.html">snort</a>
        /
	<a href="http://jantman.github.io/blog/tag/syslog.html">syslog</a>
        /
	<a href="http://jantman.github.io/blog/tag/vyatta.html">vyatta</a>
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>I&#8217;m running a <a href="http://www.vyatta.org">Vyatta</a> vyatta router at home - in
my opinion it&#8217;s pretty near &#8220;enterprise grade&#8221;, and I&#8217;m running the
Community/Core (read: no-cost and almost all Free) on commodity hardware
with great performance. Granted, I&#8217;m still on the older version (5 as
opposed to the current 6) since an upgrade will require total downtime
and a spare set of <span class="caps">SCSI</span> disks for the machine it&#8217;s on, but it still
works quite well. Today I decided to enable the
<a href="http://www.snort.org">Snort</a> <span class="caps">IDS</span> on the box. It actually worked quite
well (albeit stuck at older rules until I upgrade to Vyatta <span class="caps">VC6</span>) and
didn&#8217;t put much more load on the box. For the time being I decided to
just have it alert on problems and not drop anything, as I&#8217;m getting
pretty high false positives and the older Vyatta version doesn&#8217;t seem to
have a way to disregard&nbsp;rules.</p>
<p>My biggest complaint was that Vyatta didn&#8217;t see fit to allow alerts by
syslog. I&#8217;m not a big fan of keeping information like <span class="caps">IDS</span> logs stuck on
the router - I don&#8217;t like logging in to it any more than I have to, it
doesn&#8217;t have much storage, and I&#8217;d also like to keep stuff like this in
a more secure location. Through a bit of digging, I found the
<code>/opt/vyatta/share/perl5/VyattaSnortConfig.pm</code> Perl module which
generates the Snort config file from Vyatta&#8217;s <span class="caps">CLI</span> stuff. Looking through
the Perl code, I found the definition of the snort.conf output&nbsp;statements:</p>
<div class="codehilite"><pre><span class="k">my</span> <span class="nv">$output_def</span> <span class="o">=&lt;</span>
<span class="n">I</span> <span class="n">simply</span> <span class="n">added</span> <span class="n">a</span> <span class="n">line</span> <span class="n">output</span> <span class="n">alert_syslog:</span> <span class="n">log_local3</span> <span class="n">log_notice</span> <span class="n">after</span> <span class="n">the</span> <span class="n">output</span> <span class="n">alert_unified</span> <span class="n">line</span><span class="o">.</span>

<span class="k">my</span> <span class="nv">$output_def</span> <span class="o">=&lt;</span>
<span class="n">I</span> <span class="k">then</span> <span class="n">went</span> <span class="n">into</span> <span class="n">Vyatta</span> <span class="n">configuration</span> <span class="ow">and</span> <span class="n">changed</span> <span class="n">a</span> <span class="n">rule</span> <span class="n">from</span> <span class="n">alert</span> <span class="n">to</span> <span class="n">pass</span><span class="p">,</span> <span class="n">committed</span><span class="p">,</span> <span class="n">changed</span> <span class="n">back</span><span class="p">,</span> <span class="n">committed</span><span class="p">,</span> <span class="ow">and</span> <span class="sr">/etc/s</span><span class="n">nort</span><span class="o">/</span><span class="n">snort</span><span class="o">.</span><span class="n">conf</span> <span class="n">now</span> <span class="n">had</span> <span class="k">my</span> <span class="n">syslog</span> <span class="n">lines</span><span class="o">.</span> <span class="n">I</span><span class="s">&#39;m now getting snort alerts to local3 in syslog, which is fed to my centralized log server. My next project is to find or write something which will parse these logs, generate a daily summary email, and maybe check them hourly and alert on any big changes. I also might just cron an emailing of the output from Vyatta&#39;</span><span class="n">s</span> <span class="n">show</span> <span class="n">ips</span> <span class="n">summary</span> <span class="n">command</span><span class="o">.</span> <span class="n">So</span> <span class="n">far</span> <span class="n">I</span> <span class="n">have</span> <span class="n">over</span> <span class="mi">11</span><span class="p">,</span><span class="mo">000</span> <span class="n">events</span> <span class="n">logged</span> <span class="n">in</span> <span class="n">about</span> <span class="mi">12</span> <span class="n">hours</span><span class="o">.</span>
</pre></div>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-lg-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><h4><i class="icon-home icon-large"></i>Social</h4></li>
                    <li class="list-group-item"><a href="#"><i
                            class="icon-You can add links in your config file-sign icon-large"></i>You can add links in your config file
                    </a></li>
                    <li class="list-group-item"><a href="#"><i
                            class="icon-Another social link-sign icon-large"></i>Another social link
                    </a></li>



                <li class="list-group-item"><a href="http://jantman.github.io/blog/tags.html"><h4><i class="icon-tags icon-large"></i>Tags</h4></a></li>
                        <li class="list-group-item tag-1">
                            <a href="http://jantman.github.io/blog/tag/linux.html">
                                linux
                            </a>
                        </li>
                        <li class="list-group-item tag-1">
                            <a href="http://jantman.github.io/blog/tag/php.html">
                                PHP
                            </a>
                        </li>
                        <li class="list-group-item tag-1">
                            <a href="http://jantman.github.io/blog/tag/android.html">
                                android
                            </a>
                        </li>
                        <li class="list-group-item tag-1">
                            <a href="http://jantman.github.io/blog/tag/google.html">
                                google
                            </a>
                        </li>
                        <li class="list-group-item tag-1">
                            <a href="http://jantman.github.io/blog/tag/nagios.html">
                                Nagios
                            </a>
                        </li>
                        <li class="list-group-item tag-1">
                            <a href="http://jantman.github.io/blog/tag/sysadmin.html">
                                sysadmin
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://jantman.github.io/blog/tag/logging.html">
                                logging
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://jantman.github.io/blog/tag/wordpress.html">
                                wordpress
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://jantman.github.io/blog/tag/apache.html">
                                apache
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://jantman.github.io/blog/tag/firefox.html">
                                firefox
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://jantman.github.io/blog/tag/blog.html">
                                blog
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://jantman.github.io/blog/tag/perl.html">
                                perl
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://jantman.github.io/blog/tag/monitoring.html">
                                monitoring
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://jantman.github.io/blog/tag/microsoft.html">
                                microsoft
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://jantman.github.io/blog/tag/dns.html">
                                dns
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://jantman.github.io/blog/tag/syslog.html">
                                syslog
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://jantman.github.io/blog/tag/bind.html">
                                bind
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://jantman.github.io/blog/tag/sun.html">
                                sun
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://jantman.github.io/blog/tag/mediawiki.html">
                                mediawiki
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://jantman.github.io/blog/tag/rpm.html">
                                rpm
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://jantman.github.io/blog/tag/droid.html">
                                droid
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://jantman.github.io/blog/tag/puppet.html">
                                puppet
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://jantman.github.io/blog/tag/ems.html">
                                EMS
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://jantman.github.io/blog/tag/security.html">
                                security
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://jantman.github.io/blog/tag/mac.html">
                                mac
                            </a>
                        </li>
        </ul>
    </section>
</aside>        </div>
    </div>
</div>
<footer>
    <div class="container">
        <hr>
        <p class="pull-right"><i class="icon-arrow-up"></i> <a href="#">Back to top</a></p>


        <p>&copy; 2014 Jason Antman &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a></p>
    </div>
</footer>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://jantman.github.io/blog/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://jantman.github.io/blog/theme/js/respond.min.js"></script>


</body>
</html>