<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Jason Antman's Blog</title><link>http://newblog.jasonantman.com/</link><description></description><atom:link href="http://newblog.jasonantman.com/feeds/tags/ups.rss.xml" rel="self"></atom:link><lastBuildDate>Wed, 17 Mar 2010 22:27:00 -0400</lastBuildDate><item><title>Downtime past few days, coping with storms</title><link>http://newblog.jasonantman.com/2010/03/downtime-past-few-days-coping-with-storms/</link><description>&lt;p&gt;As far as I can see from &lt;a href="http://www.google.com/analytics/"&gt;Google
Analytics&lt;/a&gt;, though I&amp;#8217;m now up to about
4,000 visitors per month for this blog, it seems like most are one-time
visitors. So hopefully the few hiccups of the past few days weren&amp;#8217;t
noticed (except by me, and my mailserver&amp;#8230;). As many of you in the &lt;span class="caps"&gt;US&lt;/span&gt;
may know, New Jersey was hit by a pretty big nor&amp;#8217;easter last weekend and
my area was
&lt;a href="http://www.northjersey.com/news/bergen/87665172_Weekend_storm_thrashes_Wyckoff.html"&gt;especially&lt;/a&gt;
&lt;a href="http://www.northjersey.com/news/87704777_Ridgewood_power_outages_could_last_for_days.html"&gt;hard&lt;/a&gt;
&lt;a href="http://www.northjersey.com/news/87852727_Downed_trees__power_lines_bring_Glen_Rock_to_a_near_standstill.html"&gt;hit&lt;/a&gt;.
I lost power for about five hours Saturday night (the 13th) and again
for an hour or so the next morning. Needless to say, these were both
much longer than my small UPSes could cope with (the smaller of the two
has a mere 12 minutes of runtime with brand new batteries). While I do
have a small (2500W) gas generator, it was buried in the back of the
garage. The time it would take to dig it out and string extension cords
from the UPSes to a relatively dry area outside would probably be more
than 12 minutes - not to mention that as first lieutenant
(second-in-command) of the town&amp;#8217;s volunteer &lt;a href="http://www.midlandparkambulance.com/"&gt;ambulance
corps&lt;/a&gt;, I was running in the
opposite direction once things got&amp;nbsp;bad.&lt;/p&gt;
&lt;p&gt;Luckily, the problems caused or uncovered by the power loss were
relatively&amp;nbsp;minor:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The batteries in my smaller &lt;span class="caps"&gt;UPS&lt;/span&gt; lasted about 90 seconds. I&amp;#8217;d noticed
    the bad battery light a few weeks ago, but put it off (hey, it&amp;#8217;s my
    home setup, I don&amp;#8217;t exactly have a budget).
    &lt;a href="http://www.refurbups.com"&gt;RefurbUPS&lt;/a&gt;, where I got the two &lt;span class="caps"&gt;APC&lt;/span&gt;
    &lt;span class="caps"&gt;SU1000NET&lt;/span&gt;&amp;#8217;s, got me a replacement &lt;span class="caps"&gt;RBC6&lt;/span&gt; (aftermarket, not original
    &lt;span class="caps"&gt;APC&lt;/span&gt;) in two days, for around $73. Unfortunately, my Tripp Lite
    &lt;span class="caps"&gt;SMART2200RMXL2U&lt;/span&gt; (unfortunately without the external battery pack)
    also just had its orange light pop on, so there goes another&amp;nbsp;$90.&lt;/li&gt;
&lt;li&gt;The battery replacement caused another short (\~5 minute) downtime
    tonight, including my router. Unfortunately the router is plugged
    into the smaller of the two UPSes, and none of my current boxes have
    more than one power supply. Mistake. Especially considering my
    limited resources. On the positive side, I took the opportunity to
    move all of the equipment onto &lt;a href="http://www.liebert.com/product_pages/Product.aspx?id=6&amp;amp;hz=60"&gt;Liebert
    MicroPOD&lt;/a&gt;s.&lt;/li&gt;
&lt;li&gt;The external &lt;span class="caps"&gt;SATA&lt;/span&gt; disk for my desktop used to store media is dead.
    I&amp;#8217;m getting incessant read errors, followed by offlining the disk,
    on two &lt;span class="caps"&gt;USB&lt;/span&gt; adapters and internal &lt;span class="caps"&gt;SATA&lt;/span&gt;. I guess I should have a
    better surge protector for the&amp;nbsp;desktop.&lt;/li&gt;
&lt;li&gt;A few of my boxes didn&amp;#8217;t come up clean, mainly due to entropy in the
    configs, or services that were never &lt;code&gt;chkconfig&lt;/code&gt;&amp;#8216;ed. Well, I don&amp;#8217;t
    use any configuration management at&amp;nbsp;home.&lt;/li&gt;
&lt;li&gt;One of the disks in my storage server (&lt;span class="caps"&gt;RAID&lt;/span&gt; 1+0 of 6x 36.4Gb 10k &lt;span class="caps"&gt;RPM&lt;/span&gt;
    &lt;span class="caps"&gt;SCSI&lt;/span&gt; disks) died - actually a few days before the power outage. I
    was able to find a new replacement on Ebay, with warranty, for about&amp;nbsp;$40.&lt;/li&gt;
&lt;li&gt;Many of my internal services - including a lot of the
    &lt;a href="http://www.nagios.org"&gt;Nagios&lt;/a&gt; checks - use a separate gigabit
    management network, run off of an older GigE aggregation switch.
    This was on the smaller &lt;span class="caps"&gt;UPS&lt;/span&gt;, so it went down quick. As both this and
    my main switch are of the same series, perhaps an &lt;span class="caps"&gt;RPS&lt;/span&gt; unit would be
    worth the&amp;nbsp;money.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Plans for the&amp;nbsp;future:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Get &lt;a href="http://reductivelabs.com/products/puppet/"&gt;Puppet&lt;/a&gt; working at
    home. As part of this, buy a spare server so I can migrate services
    one at a time to a puppet-ized version, test, and then rebuild
    (while the production machine is still&amp;nbsp;running).&lt;/li&gt;
&lt;li&gt;In the future, given my limited infrastructure, purchasing dual
    power supply machines - and putting the PSes on separate UPSes -
    would be a good&amp;nbsp;thing.&lt;/li&gt;
&lt;li&gt;Configure the Tripp Lite &lt;span class="caps"&gt;UPS&lt;/span&gt; to do load&amp;nbsp;shedding.&lt;/li&gt;
&lt;li&gt;Setup &lt;span class="caps"&gt;UPS&lt;/span&gt; management software to bring down boxes in a logical&amp;nbsp;order.&lt;/li&gt;
&lt;li&gt;Power savings is also important - so I&amp;#8217;m thinking about rebuilding
    things using &lt;a href="http://www.xen.org/"&gt;Xen&lt;/a&gt;, and using live migration to
    both distribute load logically under normal circumstances, and to
    move around loads in the event of power failure (kill
    non-critical/internal-only stuff, consolidate the&amp;nbsp;rest).&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">admin</dc:creator><pubDate>Wed, 17 Mar 2010 22:27:00 -0400</pubDate><guid>tag:newblog.jasonantman.com,2010-03-17:2010/03/downtime-past-few-days-coping-with-storms/</guid><category>availability</category><category>power</category><category>reliability</category><category>UPS</category><category>uptime</category></item><item><title>Cable Management, Power Measurements, Major Outage, Cacti</title><link>http://newblog.jasonantman.com/2008/03/cable-management-power-measurements-major-outage-cacti/</link><description>&lt;p&gt;So, once again, still really busy. But a few new&amp;nbsp;things.&lt;/p&gt;
&lt;p&gt;First, my racks both at home and at the apartment are atrocious. They
have no cable management at all. Both started with 1-3 machines, and no
real plans for upgrades (since they&amp;#8217;re just my personal/development
machines). Unfortunately, the &amp;#8220;rack&amp;#8221; (a metal workshop shelving unit) at
home now has 8 machines and a host of ancillary equipment. The one at
the apartment - an actual 42U rack - has 5 plus a few switches,
rackmount &lt;span class="caps"&gt;KMM&lt;/span&gt;, etc. They&amp;#8217;re both a jumble of wires in the back.
Unfortunately, it seems like cable management hardware is *epxensive*.
$30 for a 2U metal blank with a few plastic split D-rings, or almost $40
for a 2-meter vertical hunk of plastic channel with slits in the sides?
So, I&amp;#8217;ve been vaguely considering what it will take to fabricate some
cable management hardware of my own. Probably just building something
out of rack blanks for the horizontal off of the switches, and buying
some sort of vertical channel for power and networking/&lt;span class="caps"&gt;KVM&lt;/span&gt;. Man, those
&lt;span class="caps"&gt;KVM&lt;/span&gt; cables sure do take up a lot of space. Also at the moment, at home
my power is all coming directly out of two UPSs, whereas at the
apartment it&amp;#8217;s straight from mains off of a surge suppressor. I&amp;#8217;s like
to buy another &lt;span class="caps"&gt;UPS&lt;/span&gt; for the apartment from RefurbUPS.com, where I got the
ones from home, and also add a &lt;span class="caps"&gt;PDU&lt;/span&gt; at home and a vertical power strip at
the&amp;nbsp;apartment.&lt;/p&gt;
&lt;p&gt;Also, at the apartment, the roommates and I have had some discussion
lately about how much power the machines draw. This mainly stemmed from
our plans to move this June, into a rented house with two more people.
This seems to be falling through, so I don&amp;#8217;t have to worry about moving
and re-cabling everything, but I&amp;#8217;m still interested in finding out how
much power is being drawn. Granted, my UPSs at home give me a
more-or-less good idea of power consumption, but I&amp;#8217;d like to know in
detail. The ideal solution would be a clamp ammeter around the mains
line to the equipment - one with a serial interface. Unfortunately, I
can&amp;#8217;t seem to find such a thing, short of a digital multimeter left on
all the time. So, I guess I&amp;#8217;ll be looking around, and if I can&amp;#8217;t find
anything specific, maybe I&amp;#8217;ll work on a microcontroller that can read
1-200mV in 1mV increments, and use it with an inductive clamp ammeter
(usual output for them is 1mV per&amp;nbsp;A).&lt;/p&gt;
&lt;p&gt;So, on Monday I got into work and couldn&amp;#8217;t access my mailserver. Weird.
I never even got any Nagios alerts. I checked Nagios and&amp;#8230; nothing. As
in no connection. I &lt;span class="caps"&gt;SSH&lt;/span&gt;&amp;#8217;d home and pinged both boxes, but nothing. The
switch showed the mail server totally offline, and the Nagios box
plugged connected but &lt;span class="caps"&gt;ZERO&lt;/span&gt; data out. I reset the counters and waited.
Still nothing. After an hour or so of poking around, I determined that
both devices were on the same 6-port group on the switch, and nothing
else there was up too. So, after five long hours, I got someone back
home to switch the cables. Still nothing. On a hunch, I asked to have
her check the mail server (the &amp;#8220;new&amp;#8221; Sun Blade 150) and, sure enough, it
wasn&amp;#8217;t powered on. A click of the power button, and the mail server was
back online. Along with an ominous last email from Nagios, stating that
the &lt;span class="caps"&gt;UPS&lt;/span&gt; running my switch lost power, and 6 minutes later, was going
down hard. Then&amp;nbsp;quiet.&lt;/p&gt;
&lt;p&gt;I don&amp;#8217;t usually have power outages. So I&amp;#8217;ll admit, when I added some of
the new machines, I committed a high sin - I &amp;#8220;never got around&amp;#8221; to
setting up everything power-wise. I also have the switch running off of
an old BackUPS &lt;span class="caps"&gt;500VA&lt;/span&gt; unit, &lt;span class="caps"&gt;USB&lt;/span&gt;, without automatic self-tests. As a
result of all&amp;nbsp;this:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The little &lt;span class="caps"&gt;UPS&lt;/span&gt; powering the switch only held out for 6-7 minutes. As
    a result, once that died, the bigger units didn&amp;#8217;t even matter, as
    all hope was lost. This needs to be on a bigger &lt;span class="caps"&gt;UPS&lt;/span&gt; - maybe one of
    the &lt;span class="caps"&gt;1000VA&lt;/span&gt;&amp;#8217;s until it gets its&amp;#8217;&amp;nbsp;own.&lt;/li&gt;
&lt;li&gt;APCupsd requires a network to initiate shutdown, so the rest of the
    machines came down hard (as confirmed by looking through log&amp;nbsp;files).&lt;/li&gt;
&lt;li&gt;The SunBlade was never setup to power on after power interruption,
    so it just sat there like a&amp;nbsp;brick.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Most disturbingly, while my Nagios/monitoring box is up (according to
the switch, power draw figures from the &lt;span class="caps"&gt;UPS&lt;/span&gt;, and the lights, as
confirmed by someone on-site), it&amp;#8217;s dead. No ping, nothing out. I&amp;#8217;ll
have to look into it, but it made me realize that this really is my only
way of analyzing problems. That needs to&amp;nbsp;stop.&lt;/p&gt;
&lt;p&gt;Maybe one day I&amp;#8217;ll have the money for a nice &lt;a href="http://www.apc.com/products/family/index.cfm?id=223"&gt;SmartUPS
&lt;span class="caps"&gt;RT&lt;/span&gt;&lt;/a&gt; or even a
&lt;a href="http://www.apc.com/products/family/index.cfm?id=189"&gt;Symmetra&lt;/a&gt; - though
getting 208V into my basement is even more of a dream than spending
$4000 on a&amp;nbsp;&lt;span class="caps"&gt;UPS&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;Also, I decided (after all this) to setup graphing of &lt;span class="caps"&gt;UPS&lt;/span&gt; data (load,
voltage in and out, temp, capacity, run time, etc.). While I haven&amp;#8217;t
gotten around to setting up &lt;a href="http://www.zenoss.com/"&gt;Zenoss&lt;/a&gt; yet, I did
a quick (well, 4 hours later I&amp;#8217;m done configuring it)
&lt;a href="http://www.cacti.net/"&gt;Cacti&lt;/a&gt;installation on my web server (I should
already have it running on the monitoring box, but who knows what that
will look like when I get&amp;nbsp;home).&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">admin</dc:creator><pubDate>Thu, 06 Mar 2008 01:02:00 -0500</pubDate><guid>tag:newblog.jasonantman.com,2008-03-06:2008/03/cable-management-power-measurements-major-outage-cacti/</guid><category>apc</category><category>cable management</category><category>cacti</category><category>disaster</category><category>monitoring</category><category>power distribution</category><category>power failure</category><category>rack</category><category>UPS</category></item><item><title>APC AP9605 PowerNet SNMP Card</title><link>http://newblog.jasonantman.com/2007/03/apc-ap9605-powernet-snmp-card/</link><description>&lt;p&gt;In the theme of upgrades, I also purchased two &lt;span class="caps"&gt;APC&lt;/span&gt; SmartUPS1000 units
from refurbUPS.com. Now, I know that a lot of people are perfectly happy
with serial connectivity. And it has its positives. But I&amp;#8217;m running 2-3
servers per &lt;span class="caps"&gt;UPS&lt;/span&gt;, older servers, wanted to be able to monitor the UPSs,
and perhaps control server shutdown, over the network.. So, I found that
refurbUPS.com also sells &lt;span class="caps"&gt;SNMP&lt;/span&gt; management cards for them. They sell a
refurbished &lt;span class="caps"&gt;AP9605&lt;/span&gt; - it&amp;#8217;s an old 10BaseT PowerNet &lt;span class="caps"&gt;SNMP&lt;/span&gt;-only card (with
telnet management). Seemed good, and the price of $15 was&amp;nbsp;right.&lt;/p&gt;
&lt;p&gt;They showed up, but I couldn&amp;#8217;t find much about them online, let alone
anything&amp;nbsp;useful.&lt;/p&gt;
&lt;p&gt;After a phone call to &lt;span class="caps"&gt;APC&lt;/span&gt;, I managed to get the user&amp;#8217;s manual emailed to
me. The few instructions I found online were totally&amp;nbsp;wrong.&lt;/p&gt;
&lt;p&gt;The general setup goes like&amp;nbsp;this:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Connect network cable to&amp;nbsp;card.&lt;/li&gt;
&lt;li&gt;Connect serial cable between a computer and the &lt;span class="caps"&gt;UPS&lt;/span&gt;&amp;#8217;s serial&amp;nbsp;port.&lt;/li&gt;
&lt;li&gt;Get a terminal emulator, like
    &lt;a href="http://alioth.debian.org/projects/minicom"&gt;minicom&lt;/a&gt;. Speed is&amp;nbsp;2400bps.&lt;/li&gt;
&lt;li&gt;connect and press enter. You&amp;#8217;ll be asked for a username and
    password. Use &amp;#8220;apc&amp;#8221; for&amp;nbsp;both.&lt;/li&gt;
&lt;li&gt;5) Setup the network - &lt;span class="caps"&gt;IP&lt;/span&gt;, mask, gateway,&amp;nbsp;etc.&lt;/li&gt;
&lt;li&gt;Ready-to-go!&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;I also have some information about the card on my wiki at:
&lt;a href="http://wiki.jasonantman.com/index.php/AP9605"&gt;&lt;span class="caps"&gt;AP9605&lt;/span&gt;&lt;/a&gt;.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">admin</dc:creator><pubDate>Thu, 01 Mar 2007 17:09:00 -0500</pubDate><guid>tag:newblog.jasonantman.com,2007-03-01:2007/03/apc-ap9605-powernet-snmp-card/</guid><category>ap9605</category><category>apc</category><category>powernet</category><category>snmp</category><category>UPS</category></item></channel></rss>