<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Jason Antman's Blog</title><link>http://newblog.jasonantman.com/</link><description></description><atom:link href="http://newblog.jasonantman.com/feeds/tags/openssh.rss.xml" rel="self"></atom:link><lastBuildDate>Mon, 16 Jul 2012 08:47:00 -0400</lastBuildDate><item><title>Logging OpenSSH SFTP Transactions</title><link>http://newblog.jasonantman.com/2012/07/logging-openssh-sftp-transactions/</link><description>&lt;p&gt;I just came across a really handy post on &lt;a href="https://plus.google.com/117561367404774597588/posts"&gt;David
Busby&lt;/a&gt;&amp;#8216;s blog:
&lt;a href="http://blog.oneiroi.co.uk/linux/enable-logging-in-the-sftp-subsystem/"&gt;Enable logging in the &lt;span class="caps"&gt;SFTP&lt;/span&gt; subsystem -
Oneiroi&lt;/a&gt;.
From OpenSSH 4.4 on, you can pass arguments to Subsystem calls, and the
sftp subsystem supports logging to an aribtrary syslog facility and
priority. Simply adding a line&amp;nbsp;like:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;Subsystem       sftp    /usr/libexec/openssh/sftp-server -f LOCAL5 -l INFO
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;and the appropriate lines to your syslog config will give you a handy
transfer log&amp;nbsp;like:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;Jul 16 09:22:25 hostname sftp-server[2058]: session opened for local user jantman from [A.B.C.D]
Jul 16 09:22:26 hostname sftp-server[2058]: open &amp;quot;/home/jantman/temp/sftp_test&amp;quot; flags WRITE,CREATE,TRUNCATE mode 0666
Jul 16 09:22:45 hostname sftp-server[2058]: close &amp;quot;/home/jantman/temp/sftp_test&amp;quot; bytes read 0 written 1464813
Jul 16 09:23:08 hostname sftp-server[2058]: session closed for local user jantman from [A.B.C.D]
Jul 16 09:27:50 hostname sftp-server[2309]: session opened for local user jantman from [A.B.C.D]
Jul 16 09:27:50 hostname sftp-server[2309]: open &amp;quot;/home/jantman/temp/sftp_test&amp;quot; flags READ mode 0666
Jul 16 09:27:54 hostname sftp-server[2309]: close &amp;quot;/home/jantman/temp/sftp_test&amp;quot; bytes read 1464813 written 0
Jul 16 09:27:54 hostname sftp-server[2309]: session closed for local user jantman from [A.B.C.D]
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;If you have syslog write these logs to their own file, remember to setup
log rotation for&amp;nbsp;them.&lt;/p&gt;
&lt;p&gt;Unfortunately, I&amp;#8217;m not aware of any way to log &lt;span class="caps"&gt;SCP&lt;/span&gt; file&amp;nbsp;transfers.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">admin</dc:creator><pubDate>Mon, 16 Jul 2012 08:47:00 -0400</pubDate><guid>tag:newblog.jasonantman.com,2012-07-16:2012/07/logging-openssh-sftp-transactions/</guid><category>logging</category><category>openssh</category><category>sftp</category><category>ssh</category></item><item><title>HP Prolaint iLO SSH Problems</title><link>http://newblog.jasonantman.com/2009/06/hp-prolaint-ilo-ssh-problems/</link><description>&lt;p&gt;There&amp;#8217;s a known issue with the &lt;span class="caps"&gt;SSH&lt;/span&gt; implementation in the iLO firmware
for &lt;span class="caps"&gt;HP&lt;/span&gt; Proliant servers (specifically G2 and G3) and OpenSSH 5.1p1.
There was a
&lt;a href="http://marc.info/?l=openssh-unix-dev&amp;amp;m=122095298729858&amp;amp;w=2"&gt;thread&lt;/a&gt; on
the OpenSSH developers list that referenced this problem and suggested a
solution, but it doesn&amp;#8217;t seem to be a sure&amp;nbsp;fix.&lt;/p&gt;
&lt;p&gt;This problem is present on my &lt;span class="caps"&gt;DL360&lt;/span&gt; G2&amp;#8217;s which are running the 1.84
2006-05-05 version of the iLO firmware (iLO 1.84 pass9) with the P26
2004.05.01 version of the system firmware. I also see the issue on a
&lt;span class="caps"&gt;DL380G3&lt;/span&gt; running iLO 1.92 2008.04.24 and system firmware P29 2004.09.15.
The only way that I can reliably get into the iLO is by SSHing from a
box with an older version of &lt;span class="caps"&gt;SSH&lt;/span&gt;, such as&amp;nbsp;4.2p1.&lt;/p&gt;
&lt;p&gt;Most of the things that I could find online referenced unsetting the
&lt;span class="caps"&gt;LANG&lt;/span&gt; environment variable (&lt;code&gt;unset LANG&lt;/code&gt;) and then SSHing with agent forwarding disabled (&lt;code&gt;ssh -a hostname-ilo&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;Unfortunately this combination doesn&amp;#8217;t seem to do it for&amp;nbsp;me.&lt;/p&gt;
&lt;p&gt;I happened to stumble by &lt;a href="http://www.mail-archive.com/debian-ssh@lists.debian.org/msg00904.html"&gt;this
post&lt;/a&gt;
to the debian-ssh mailing list, which suggested that shortening the new
OpenSSH version string fixed the&amp;nbsp;problem.&lt;/p&gt;
&lt;p&gt;I was able to confirm that the version string is, in fact, the sole
problem. I downloaded the source of OpenSSH 5.2p1 and, with the
following small patch to version.h, managed to get &lt;span class="caps"&gt;SSH&lt;/span&gt; working to the
iLO&amp;nbsp;perfectly:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="gd"&gt;--- openssh-patched/version.h   2009-06-12 00:35:48.000000000 -0400&lt;/span&gt;
&lt;span class="gi"&gt;+++ openssh-5.2p1/version.h     2009-02-22 19:09:26.000000000 -0500&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,6 +1,6 @@&lt;/span&gt;
 /* $OpenBSD: version.h,v 1.55 2009/02/23 00:06:15 djm Exp $ */

&lt;span class="gd"&gt;-#define SSH_VERSION    &amp;quot;OpenSSH&amp;quot;&lt;/span&gt;
&lt;span class="gi"&gt;+#define SSH_VERSION    &amp;quot;OpenSSH_5.2&amp;quot;&lt;/span&gt;

&lt;span class="gd"&gt;-#define SSH_PORTABLE   &amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="gi"&gt;+#define SSH_PORTABLE   &amp;quot;p1&amp;quot;&lt;/span&gt;
 #define SSH_RELEASE    SSH_VERSION SSH_PORTABLE
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;I patched version.h, ran &lt;code&gt;./configure&lt;/code&gt;, &lt;code&gt;make&lt;/code&gt;, and then copied the
compiled ssh binary to /usr/bin/ilossh, so that my original ssh binary
would be intact, and the ilossh binary would be left alone by &lt;span class="caps"&gt;RPM&lt;/span&gt;&amp;nbsp;upgrades.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">admin</dc:creator><pubDate>Thu, 11 Jun 2009 23:52:00 -0400</pubDate><guid>tag:newblog.jasonantman.com,2009-06-11:2009/06/hp-prolaint-ilo-ssh-problems/</guid><category>ilo</category><category>openssh</category><category>proliant</category><category>ssh</category></item></channel></rss>