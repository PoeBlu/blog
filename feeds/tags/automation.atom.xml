<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Jason Antman's Blog - automation</title><link href="http://blog.jasonantman.com/" rel="alternate"></link><link href="http://blog.jasonantman.com/feeds/tags/automation.atom.xml" rel="self"></link><id>http://blog.jasonantman.com/</id><updated>2009-02-03T15:51:00-05:00</updated><entry><title>How To Wipe a Bunch of Machines Quickly</title><link href="http://blog.jasonantman.com/2009/02/how-to-wipe-a-bunch-of-machines-quickly/" rel="alternate"></link><published>2009-02-03T15:51:00-05:00</published><updated>2009-02-03T15:51:00-05:00</updated><author><name>admin</name></author><id>tag:blog.jasonantman.com,2009-02-03:/2009/02/how-to-wipe-a-bunch-of-machines-quickly/</id><summary type="html">&lt;p&gt;&lt;strong&gt;Updated 2009-03-05, see&amp;nbsp;bottom.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;At work the other week, we decommissioned 24 old desktops - Dell &lt;span class="caps"&gt;GX280&lt;/span&gt;&amp;#8217;s
that were used in the student labs as print release stations. They
didn&amp;#8217;t have anything sensitive on them, just Windows &lt;span class="caps"&gt;XP&lt;/span&gt;, but with
licensing and all we have to wipe Windows off …&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;strong&gt;Updated 2009-03-05, see&amp;nbsp;bottom.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;At work the other week, we decommissioned 24 old desktops - Dell &lt;span class="caps"&gt;GX280&lt;/span&gt;&amp;#8217;s
that were used in the student labs as print release stations. They
didn&amp;#8217;t have anything sensitive on them, just Windows &lt;span class="caps"&gt;XP&lt;/span&gt;, but with
licensing and all we have to wipe Windows off of them before surplussing
them. Since there were 24 of them, it wasn&amp;#8217;t exactly going to be the
quickest task. Moreover, the &lt;span class="caps"&gt;GX280&lt;/span&gt;&amp;#8217;s we used don&amp;#8217;t have &lt;em&gt;any&lt;/em&gt; removable
media&amp;nbsp;drives.&lt;/p&gt;
&lt;p&gt;A few people mentioned &lt;a href="http://www.dban.org/"&gt;Darik&amp;#8217;s Boot And Nuke&lt;/a&gt;
(&lt;span class="caps"&gt;DBAN&lt;/span&gt;), which is a bootable Linux distro (&lt;span class="caps"&gt;CD&lt;/span&gt; or floppy) aimed at wiping
all of the fixed disks attached to a machine. While they do offer an
&amp;#8220;Enterprise&amp;#8221; version that supports network booting (and logging wipe
verifications to a central machine), the pricing isn&amp;#8217;t exactly favorable
for a small project (or something that just needs Windows to go away,
not a DoD-grade 7-pass overwrite with random data). Between the lack of
a &lt;span class="caps"&gt;CD&lt;/span&gt; drive and the apparent need to select wiping options at boot, this
didn&amp;#8217;t seem to be the best method for&amp;nbsp;me.&lt;/p&gt;
&lt;p&gt;Luckily, with a little googling, I came by the
&lt;a href="https://fedorahosted.org/cobbler/"&gt;Cobbler&lt;/a&gt; project, a ready-to-run
install server aimed at automating network-based &lt;span class="caps"&gt;OS&lt;/span&gt; installation. It
turns out that Cobbler has a wiki article on &lt;a href="https://fedorahosted.org/cobbler/wiki/SystemRetirement"&gt;system
retirement&lt;/a&gt; that
deals with using Cobbler to automate a network boot of &lt;span class="caps"&gt;DBAN&lt;/span&gt;. Cobbler
takes control of &lt;span class="caps"&gt;DHCP&lt;/span&gt; and &lt;span class="caps"&gt;TFTP&lt;/span&gt;, boots the machine(s) to a &lt;span class="caps"&gt;PXE&lt;/span&gt; boot menu,
and allows selection of one of the cobbler&amp;nbsp;&amp;#8220;profiles&amp;#8221;.&lt;/p&gt;
&lt;p&gt;The general procedure is something along these&amp;nbsp;lines:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Get the &lt;span class="caps"&gt;DBAN&lt;/span&gt; iso and grab the .ima image off of it. Loopback mount&amp;nbsp;it.&lt;/li&gt;
&lt;li&gt;Copy the &lt;code&gt;initrd&lt;/code&gt; and kernel into &lt;code&gt;/opt/cobbler/dban&lt;/code&gt; as
    &lt;code&gt;initrd.img&lt;/code&gt; and &lt;code&gt;vmlinuz&lt;/code&gt;,&amp;nbsp;respectively.&lt;/li&gt;
&lt;li&gt;Assuming you have cobblerd running (cobbler check), add a Distro for
    &lt;span class="caps"&gt;DBAN&lt;/span&gt;:
    &lt;code&gt;cobbler distro add --name=DBAN-1.0.7-i386 --kernel=/opt/cobbler/dban/vmlinuz --initrd=/opt/cobbler/dban/initrd.img --kopts="root=/dev/ram0 init=/rc nuke=dwipe floppy=0,16,cmos"&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Add a Profile for it:
    &lt;code&gt;cobbler profile add --name=DBAN-1.0.7-i386 --distro=DBAN-1.0.7-i386&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;cobbler sync&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Assuming all went well, when we &lt;span class="caps"&gt;PXE&lt;/span&gt; boot a machine on the same &lt;span class="caps"&gt;LAN&lt;/span&gt; as
the Cobbler system, we&amp;#8217;ll get &lt;span class="caps"&gt;DHCP&lt;/span&gt; and a &lt;span class="caps"&gt;PXE&lt;/span&gt; boot menu which will list
&lt;code&gt;DBAN-1.0.7.i386&lt;/code&gt; as one of the options. On some of the &lt;span class="caps"&gt;GX280&lt;/span&gt;&amp;#8217;s that I
did, I had to go into the &lt;span class="caps"&gt;BIOS&lt;/span&gt; and enable &lt;span class="caps"&gt;PXE&lt;/span&gt; boot (or select &lt;span class="caps"&gt;PXE&lt;/span&gt; from
the &lt;span class="caps"&gt;BIOS&lt;/span&gt; boot menu). Now, when &lt;span class="caps"&gt;DBAN&lt;/span&gt; boots, we&amp;#8217;ll get the standard dmesg
output and then a selection screen allowing us to pick a wipe type (I
used the single pass all zeros for just getting rid of the old &lt;span class="caps"&gt;OS&lt;/span&gt;) and
select which disks to wipe. If you use the default wipe, just press
&amp;#8220;space&amp;#8221; to select all disks and then &amp;#8220;F10&amp;#8221; to begin the&amp;nbsp;wipe.&lt;/p&gt;
&lt;p&gt;This process allowed me to wipe 7 machines at once (8 port &lt;span class="caps"&gt;KVM&lt;/span&gt;, 1 port
for the server). With a better &lt;span class="caps"&gt;KVM&lt;/span&gt; or (even better yet) a totally
automatic system as described below, it would essentially be limited to
whatever the server and network hardware will&amp;nbsp;handle.&lt;/p&gt;
&lt;p&gt;To add a little more automation, we can run
&lt;code&gt;cobbler system add --name=default --profile=DBAN-1.0.7-i386&lt;/code&gt; which adds
a default profile to Cobbler, saying that any machines with MACs not
specifically assigned to a profile should boot the &lt;span class="caps"&gt;DBAN&lt;/span&gt; profile, and
bypassing the &lt;span class="caps"&gt;PXE&lt;/span&gt; boot&amp;nbsp;menu.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span class="caps"&gt;WARNING&lt;/span&gt;:&lt;/strong&gt; what follows will setup Cobbler and &lt;span class="caps"&gt;DBAN&lt;/span&gt; to automatically
wipe all &lt;span class="caps"&gt;PXE&lt;/span&gt;-booting devices without &lt;span class="caps"&gt;ANY&lt;/span&gt; human intervention. Use at your
own risk and, for God&amp;#8217;s sake, don&amp;#8217;t plug your server into a production
network (I recommend this only in a lab environment with a dedicated
switch, all machines in one physical area, and no possibility of getting
on the same &amp;#8216;net as production&amp;nbsp;machines).&lt;/p&gt;
&lt;p&gt;It&amp;#8217;s theoretically possible to totally automate this setup. According to
the &lt;span class="caps"&gt;DBAN&lt;/span&gt; docs, it will also accept kernel options (kopts) that effect
how dnuke works - specifically, &lt;code&gt;--autonuke&lt;/code&gt; to tell it to wipe without
human intervention and a method option such as &lt;code&gt;--method=zero&lt;/code&gt; to select
the wipe method. This means that if we &lt;span class="caps"&gt;PXE&lt;/span&gt; boot with kernel options set
to &lt;code&gt;nuke="dwipe --autonuke --method=zero"&lt;/code&gt; we should go straight to the
dwipe utility (the heart of &lt;span class="caps"&gt;DBAN&lt;/span&gt;) and automatically wipe all disks by
writing zeros once - without operator intervention. Unfortunately,
there&amp;#8217;s a &lt;a href="https://fedorahosted.org/cobbler/ticket/148"&gt;bug&lt;/a&gt; in the
current (1.4.0) Cobbler which prevents quote-encapsulated strings in
kopts, meaning that we can&amp;#8217;t set one kernel option to a string with
whitespace as needed here. If this bug is fixed, it should allow this
process to work without any operator intervention, assuming the clients
will &lt;span class="caps"&gt;PXE&lt;/span&gt;&amp;nbsp;boot.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Updated 2009-03-05&lt;/strong&gt; I haven&amp;#8217;t tested it yet, but apparently the
Cobbler bug preventing complex kernel options has &lt;a href="https://fedorahosted.org/pipermail/cobbler/2009-February/002874.html"&gt;been
fixed&lt;/a&gt;.
The fix should be included in the 1.4.3 release and is currently in the
development&amp;nbsp;tree.&lt;/p&gt;</content><category term="automation"></category><category term="cobbler"></category><category term="dban"></category><category term="pxe"></category><category term="retirement"></category><category term="security"></category><category term="wiping"></category></entry><entry><title>New Project</title><link href="http://blog.jasonantman.com/2008/06/new-project/" rel="alternate"></link><published>2008-06-04T10:34:00-04:00</published><updated>2008-06-04T10:34:00-04:00</updated><author><name>admin</name></author><id>tag:blog.jasonantman.com,2008-06-04:/2008/06/new-project/</id><summary type="html">&lt;p&gt;Well, TuxTruck has been temporarily put on the back burner. I priced out
the hardware, and it looks like a minimum of $1000, more like $1000 if I
get what I had originally wanted. This is complicated by the fact that
my roommates and I were just hit with a …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Well, TuxTruck has been temporarily put on the back burner. I priced out
the hardware, and it looks like a minimum of $1000, more like $1000 if I
get what I had originally wanted. This is complicated by the fact that
my roommates and I were just hit with a $220 electric bill. Mostly,
that&amp;#8217;s due to the central air conditioning in our apartment, and the
horrible inefficiencies with&amp;nbsp;it.&lt;/p&gt;
&lt;p&gt;Inefficient? Yes. At the moment, I&amp;#8217;m the only person in the apartment.
I&amp;#8217;m home for the weekend from 18:00 Friday through about 15:00 Monday. I
have class Monday-Thursday night 18:00-21:45. I work Tuesday-Friday
0900-1700. Even though the thermostat we have is &amp;#8220;programmable&amp;#8221;, it can
only be set for 4 time periods per day, weekdays and weekends. So, I
figured that a little added efficiency in calculating when the A/C
should run would go a long way towards energy&amp;nbsp;savings.&lt;/p&gt;
&lt;p&gt;My idea - tuxOstat - is to have a Linux box that has temperature sensors
placed around the apartment, and a bank of relays to control the
heating/cooling systems. So, even though I only got the idea last
Thursday, version 1 should be up and running next&amp;nbsp;week.&lt;/p&gt;
&lt;p&gt;In terms of&amp;nbsp;hardware:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Originally I had planned on using a &lt;a href="http://www.soekris.com/net4526.htm"&gt;Soekris
    net4526&lt;/a&gt; that I had lying
    around. However, the added cost of a MiniPCI &lt;span class="caps"&gt;USB&lt;/span&gt; card seemed
    prohibitive for a one-off project. Instead, I&amp;#8217;m using an old &lt;span class="caps"&gt;HP&lt;/span&gt;
    OmniBook laptop that was already lying behind my servers. It&amp;#8217;s
    running Debian&amp;nbsp;4.0.&lt;/li&gt;
&lt;li&gt;I&amp;#8217;ve ordered (just 15 minutes ago) a &lt;a href="http://www.phidgets.com/products.php?product_id=1014"&gt;Phidgets InterfaceKit
    0/0/4&lt;/a&gt;, which
    connects via &lt;span class="caps"&gt;USB&lt;/span&gt; and provides 4 relays. One will control the fan,
    one for the A/C compressor, one for the heat, and one unused (for&amp;nbsp;now).&lt;/li&gt;
&lt;li&gt;I already had a
    &lt;a href="http://www.hobby-boards.com/catalog/product_info.php?cPath=23&amp;amp;products_id=1503"&gt;&lt;span class="caps"&gt;DS9490&lt;/span&gt;&lt;/a&gt;
    Dallas 1-wire &lt;span class="caps"&gt;USB&lt;/span&gt; adapter from
    &lt;a href="http://www.hobby-boards.com/"&gt;Hobby-Boards.com&lt;/a&gt; along with five
    &lt;a href="http://www.hobby-boards.com/catalog/product_info.php?products_id=93"&gt;&lt;span class="caps"&gt;DS18S20P&lt;/span&gt;&lt;/a&gt;
    1-wire parasite power temperature sensors. I&amp;#8217;ve wired those up with
    one in the living room near the existing thermostat, one in my
    bedroom, and one stuck about five feet up one of the A/C conduits,
    to sense when the system is actually putting out cold air. I&amp;#8217;ve had
    them logging to MySQL since 0200&amp;nbsp;today.&lt;/li&gt;
&lt;li&gt;I decided to bite the bullet and order a beautiful &lt;a href="http://www.crystalfontz.com/products/635xes/index.html"&gt;CrystalFontz
    &lt;span class="caps"&gt;XES635BK&lt;/span&gt;-&lt;span class="caps"&gt;TMF&lt;/span&gt;-&lt;span class="caps"&gt;KU&lt;/span&gt;&lt;/a&gt;
    for the physical interface. It&amp;#8217;s a little backlit &lt;span class="caps"&gt;LCD&lt;/span&gt; display, in a
    surface-mount box, along with four bi-color LEDs and a 6-button
    keypad. That should handle the interface for anyone who doesn&amp;#8217;t want
    to grab a&amp;nbsp;console.&lt;/li&gt;
&lt;li&gt;I&amp;#8217;ll be looking for a eight-pin header so that the relays will plug
    right in to the screw-terminal block that the thermostat uses, to
    make for easy switching to the original thermostat if needed (or
    when moving out in a&amp;nbsp;year).&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Now, in terms of&amp;nbsp;software:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;A Python text-based configuration/administration program. Will be
    accessed via &lt;span class="caps"&gt;SSH&lt;/span&gt; or &lt;span class="caps"&gt;KVM&lt;/span&gt; for the actual&amp;nbsp;machine.&lt;/li&gt;
&lt;li&gt;Lots of state data stored in files under&amp;nbsp;/var.&lt;/li&gt;
&lt;li&gt;A python script, run via cron every 2 minutes, that checks
    temperatures from the 1-wire bus, logs them to MySQL (on a remote
    host) and updates the temperature files in&amp;nbsp;/var.&lt;/li&gt;
&lt;li&gt;A master control script, run via cron every minute, that looks at
    the temperatures, the current system state, any manual overrides
    that exist, and decides what relays should be on or&amp;nbsp;off.&lt;/li&gt;
&lt;li&gt;A daemon to handle relay&amp;nbsp;control.&lt;/li&gt;
&lt;li&gt;A daemon to handle the &lt;span class="caps"&gt;LCD&lt;/span&gt; display output and keypad input
    (including immediate manual&amp;nbsp;overrides).&lt;/li&gt;
&lt;li&gt;A method of providing overrides of the programmed schedule on a
    single-instance basis, i.e. &amp;#8220;system completely off from 2008-06-06
    18:00 to 2008-06-08&amp;nbsp;15:00&amp;#8221;.&lt;/li&gt;
&lt;/ol&gt;</content><category term="1wire"></category><category term="automation"></category><category term="home control"></category><category term="linux"></category><category term="thermostat"></category></entry></feed>