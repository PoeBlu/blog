<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Jason Antman's Blog - arch</title><link href="https://blog.jasonantman.com/" rel="alternate"></link><link href="https://blog.jasonantman.com/feeds/tags/arch.atom.xml" rel="self"></link><id>https://blog.jasonantman.com/</id><updated>2019-03-25T21:10:00-04:00</updated><entry><title>Arch Linux on a Dell Precision 5530 / XPS 15 9570Â Laptop</title><link href="https://blog.jasonantman.com/2019/03/arch-linux-on-a-dell-precision-5530--xps-15-9570-laptop/" rel="alternate"></link><published>2019-03-25T21:10:00-04:00</published><updated>2019-03-25T21:10:00-04:00</updated><author><name>Jason Antman</name></author><id>tag:blog.jasonantman.com,2019-03-25:/2019/03/arch-linux-on-a-dell-precision-5530--xps-15-9570-laptop/</id><summary type="html">&lt;p&gt;The trouble I went through installing Arch Linux on a Precision 5530 (very similar to &lt;span class="caps"&gt;XPS&lt;/span&gt; 15 9570) and how it was&amp;nbsp;solved.&lt;/p&gt;</summary><content type="html">&lt;p&gt;One of the&amp;#8230; things that, around the beginning of the year, I tentatively planned to do more of this year&amp;#8230; was to share more of what I do and resurrect this blog. Well, it&amp;#8217;s nearing the end of March, so it&amp;#8217;s a good thing I didn&amp;#8217;t make any formal New Year&amp;#8217;s resolutions! In general I&amp;#8217;ve been really busy at work with some esoteric big-company stuff, and really busy in my personal life as well with a new car and a bunch of projects around the house (including trying my hand at building a small shelving unit completely by hand, including some simple&amp;nbsp;joinery).&lt;/p&gt;
&lt;p&gt;Two weeks ago my company replaced my four-year-old (mid-2015) MacBook Pro 11,4 (original &lt;a href="https://github.com/jantman/workstation-bootstrap/blob/master/macbookpro11%2C4_install.md"&gt;install notes&lt;/a&gt;) with a shiny, brand-new MacBook Pro 15,4 A1990. I&amp;#8217;d been dual-booting my previous &lt;span class="caps"&gt;MBP&lt;/span&gt; between Linux (for any real work) and MacOS (for Netflix and quick Googles while at home) as I&amp;#8217;ve been doing with MacBook Pros for almost a decade now, and loved it. Unfortunately, as is described in detail at &lt;a href="https://github.com/Dunedan/mbp-2016-linux/issues/71"&gt;Dunedan/mbp-2016-linux Issue #71&lt;/a&gt; as well as numerous &lt;a href="https://unix.stackexchange.com/questions/463422/how-can-you-get-any-version-of-linux-to-see-the-2018-macbook-pro-ssd/479544"&gt;other&lt;/a&gt; &lt;a href="https://forum.level1techs.com/t/linux-doesnt-support-t2-as-a-ssd-controller-apples-t2-secure-boot-chip-is-blocking-usage-of-linux-in-t2-chip-macs/134832/36"&gt;places&lt;/a&gt; online, because of the T2 security chip acting as the storage controller for the &lt;span class="caps"&gt;SSD&lt;/span&gt;, it&amp;#8217;s currently impossible to install Linux on the built-in SSDs of the latest generation MacBook Pro. So I threw in the towel and requested to be re-platformed to a Dell laptop, and listed my &lt;a href="https://github.com/jantman/puppet-archlinux-macbookretina"&gt;puppet-archlinux-macbookretina&lt;/a&gt; module as unsupported and in need of a&amp;nbsp;maintainer.&lt;/p&gt;
&lt;p&gt;Last week I picked up my &lt;em&gt;new&lt;/em&gt; new work laptop, a Dell Precision 5530. I&amp;#8217;d asked about an &lt;span class="caps"&gt;XPS&lt;/span&gt; 15 as those seem to be on par with the MacBook Pro in terms of price and specs, but when you work at a company with 34,000 employees and they tell you &amp;#8220;our developer laptop is a Precision 5530&amp;#8221; and you&amp;#8217;re a developer, that&amp;#8217;s the laptop you get. I was pleased to find out, though, that &lt;strong&gt;the internal hardware of the Precision 5530 is extremely similar to the &lt;span class="caps"&gt;XPS&lt;/span&gt; 15 9570&lt;/strong&gt;, including having some of the same&amp;nbsp;issues.&lt;/p&gt;
&lt;p&gt;My odyssey of getting &lt;a href="https://www.archlinux.org/"&gt;Arch Linux&lt;/a&gt; - my desktop distribution of choice for the past six years - installed on the new Dell laptop took me thirty hours or so (conservatively) over the course of one work day and four afternoons/evenings. The first day was mostly spent getting up to speed on changes in Arch in the past few years and the current best way to handle &lt;span class="caps"&gt;LUKS&lt;/span&gt;/dm-crypt encryption on an &lt;span class="caps"&gt;EFI&lt;/span&gt; system with NVMe storage. My first install was completely ruined when I got to the (literally) last step and realized that I&amp;#8217;d forgotten to create an &lt;span class="caps"&gt;EFI&lt;/span&gt; system partition (&lt;span class="caps"&gt;ESP&lt;/span&gt;), so I started over. Luckily, as usual, I&amp;#8217;d &lt;a href="https://github.com/jantman/workstation-bootstrap/blob/master/precision5530_install.md"&gt;documented&lt;/a&gt; every step of the install process in excruciating&amp;nbsp;detail.&lt;/p&gt;
&lt;p&gt;When I finally got the system installed, I ran up against an interesting problem: when I launched Xorg, the laptop screen was either black (no backlight on at all), backlight black with no image, or flashing on and off. I fought with this for the better part of two days before I decided to try connecting an external display, and sure enough, &lt;em&gt;that&lt;/em&gt; worked fine. I spent another two days or so with the laptop hooked up to an external monitor, repeating everything I&amp;#8217;d done before, trying every combination I could think of of graphics drivers (nvidia and nouveau, intel i915 and not), graphics-related kernel parameters, Nvidia Optimus / &lt;span class="caps"&gt;PRIME&lt;/span&gt; software, etc. Finally, when I was well past my wits end and turned back to Google, I found a kernel bug for the issue and an eight-character patch that fixed&amp;nbsp;it.&lt;/p&gt;
&lt;h2 id="the-solution"&gt;&lt;a class="toclink" href="#the-solution"&gt;The&amp;nbsp;Solution&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;It turns out that the non-functional laptop display on these models is caused by &lt;a href="https://github.com/torvalds/linux/commit/7769db5883841b03de544a35a71ff528d4131c17"&gt;this commit&lt;/a&gt; to the kernel &lt;code&gt;i915&lt;/code&gt; driver. The commit specifically effects embedded Display Port (eDP) displays, and changes the link configuration algorithm from the older variant that uses more data lanes with a slower link speed (&amp;#8220;wide and slow&amp;#8221;) to the newer eDP standard&amp;#8217;s recommendation of fewer lanes with a higher link speed (&amp;#8220;fast and narrow&amp;#8221;). Unfortunately, it seems that the hardware in some of these Dell laptops will not function with this new method (even though the specification it was introduced in is &lt;em&gt;six&lt;/em&gt; years old and, according to the commit message, they should be reporting that they&amp;#8217;re compatible with&amp;nbsp;it).&lt;/p&gt;
&lt;p&gt;After another exhaustive Google search lead me to the &lt;a href="https://wiki.archlinux.org/index.php/Dell_XPS_15_9570"&gt;Dell &lt;span class="caps"&gt;XPS&lt;/span&gt; 15 9570 Arch Wiki page&lt;/a&gt;, which contains a &lt;a href="https://wiki.archlinux.org/index.php/Dell_XPS_15_9570#Built-in_screen_flickers_or_does_not_come_on_with_Linux_kernel_5.0.x"&gt;troubleshooting section&lt;/a&gt; describing exactly this problem (well&amp;#8230; it does now&amp;#8230;) and pointing to &lt;a href="https://bugs.archlinux.org/task/61964"&gt;ArchLinux bug 61964&lt;/a&gt;. Somehow I found my way to the relevant upstream bug, &lt;a href="https://bugs.freedesktop.org/show_bug.cgi?id=109959"&gt;FreeDesktop.org bug 109959&lt;/a&gt;, which contains both multiple reports of the same issue as well as two kernel patches which fix&amp;nbsp;it.&lt;/p&gt;
&lt;p&gt;Applying the noted kernel patches - and switching from &lt;code&gt;nvidia&lt;/code&gt; to &lt;code&gt;nvidia-dkms&lt;/code&gt; to support the custom kernel - fixed the bug completely, and graphics on the laptop now work&amp;nbsp;perfectly.&lt;/p&gt;
&lt;p&gt;For anyone else who&amp;#8217;s running Arch, until the bug is fixed upstream and Arch picks it up in their official kernel, I have my &lt;span class="caps"&gt;PKGBUILD&lt;/span&gt; file and sources in &lt;a href="https://github.com/jantman/arch-pkgbuilds/tree/master/linux-precision5530"&gt;my arch-pkgbuilds GitHub repo&lt;/a&gt; as well as (unsigned, sorry) compiled binary packages in my &lt;a href="http://archrepo.jasonantman.com/current/index.html"&gt;arch packages repo (index page)&lt;/a&gt;.&lt;/p&gt;</content><category term="arch"></category><category term="linux"></category><category term="dell"></category><category term="precision"></category><category term="xps"></category><category term="i915"></category><category term="nvidia"></category><category term="video"></category><category term="graphics"></category><category term="install"></category><category term="laptop"></category></entry></feed>