<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Virtualization Options - Jason Antman's Blog</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://blog.jasonantman.com/2010/03/virtualization-options/">

        <meta name="author" content="admin" />
        <meta name="keywords" content="OpenVZ,virtualization,xen" />
        <meta name="description" content="As I mentioned in Downtime past few days, coping with storms, as a result of some things I noticed with a recent power outage, I’ve decided to take the leap to virtualization. Given the cost of current hardware that supports HVM (Intel VT-x or AMD-V ), I immediately …" />

        <meta property="og:site_name" content="Jason Antman's Blog" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Virtualization Options"/>
        <meta property="og:url" content="http://blog.jasonantman.com/2010/03/virtualization-options/"/>
        <meta property="og:description" content="As I mentioned in Downtime past few days, coping with storms, as a result of some things I noticed with a recent power outage, I’ve decided to take the leap to virtualization. Given the cost of current hardware that supports HVM (Intel VT-x or AMD-V ), I immediately …"/>
        <meta property="article:published_time" content="2010-03-19" />
            <meta property="article:section" content="Projects" />
            <meta property="article:tag" content="OpenVZ" />
            <meta property="article:tag" content="virtualization" />
            <meta property="article:tag" content="xen" />
            <meta property="article:author" content="admin" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://blog.jasonantman.com/theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="http://blog.jasonantman.com/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://blog.jasonantman.com/theme/css/pygments/default.css" rel="stylesheet">
        <link href="http://blog.jasonantman.com/theme/css/typogrify.css" rel="stylesheet">
    <link rel="stylesheet" href="http://blog.jasonantman.com/theme/css/style.css" type="text/css"/>
        <link href="http://blog.jasonantman.com/theme/css/shariff/shariff.min.css" rel="stylesheet">

    <link rel="stylesheet" href="http://blog.jasonantman.com/theme/css/forkongithub.min.css" type="text/css" />

        <link href="http://blog.jasonantman.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Jason Antman's Blog ATOM Feed"/>

        <link href="http://blog.jasonantman.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate"
              title="Jason Antman's Blog RSS Feed"/>


        <link href="http://blog.jasonantman.com/feeds/categories/projects.atom.xml" type="application/atom+xml" rel="alternate"
              title="Jason Antman's Blog Projects ATOM Feed"/>

    <script src="https://widget.battleforthenet.com/widget.js" async></script>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
<span id="forkongithub"><a href="https://github.com/jantman/blog">Fork me on GitHub</a></span>        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://blog.jasonantman.com/" class="navbar-brand">
Jason Antman's Blog            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="http://blog.jasonantman.com/pages/about.html">
                             About&nbsp;Me
                          </a></li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/ideas-and-rants/index.html">Ideas and rants</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/miscellaneous/index.html">Miscellaneous</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/monitoring/index.html">Monitoring</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/ops/index.html">Ops</a>
                        </li>
                        <li class="active">
                            <a href="http://blog.jasonantman.com/categories/projects/index.html">Projects</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/puppet/index.html">Puppet</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/tech-howtos/index.html">Tech howtos</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="http://blog.jasonantman.com/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://blog.jasonantman.com/2010/03/virtualization-options/"
                       rel="bookmark"
                       title="Permalink to Virtualization Options">
                        Virtualization&nbsp;Options
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2010-03-19T20:55:00-04:00"> Fri 19 March 2010</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="http://blog.jasonantman.com/tags/openvz/index.html">OpenVZ</a>
        /
	<a href="http://blog.jasonantman.com/tags/virtualization/index.html">virtualization</a>
        /
	<a href="http://blog.jasonantman.com/tags/xen/index.html">xen</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>As I mentioned in <a href="/2010/03/downtime-past-few-days-coping-with-storms/">Downtime past few days, coping with
storms</a>, as a
result of some things I noticed with a recent power outage, I&#8217;ve decided
to take the leap to virtualization. Given the cost of current hardware
that supports <span class="caps">HVM</span> (Intel <span class="caps">VT</span>-x or <span class="caps">AMD</span>-V ), I immediately decided that I
might as well give up on any thoughts of doing full virtualization or
getting new-ish hardware. So I settled on the next step up from what
have now - a set of <a href="http://h18000.www1.hp.com/products/quickspecs/11504_na/11504_na.HTML"><span class="caps">HP</span> Proliant <span class="caps">DL360</span>
G3</a>
servers. I got them with a 90 day warranty from a reputable dealer, dual
2.8GHz Xeon (512K cache), 2Gb <span class="caps">RAM</span>, dual 36.4Gb U320 15k <span class="caps">RPM</span> <span class="caps">SCSI</span> disks
and dual power supplies for $99 each. My next step is to decide what
virtualization software to&nbsp;use.</p>
<p>My main goals for the project&nbsp;are:</p>
<ul>
<li>Lower power consumption through consolidation of&nbsp;servers.</li>
<li>Possibility to add capacity or resources by remotely powering up an
    idle server and migrating VMs to&nbsp;it.</li>
<li>Limited fault tolerance - ability to manually restore a <span class="caps">VM</span> that was
    running on failed hardware, onto an idle&nbsp;server.</li>
</ul>
<p>I originally thought Xen, just out of reflex. However, given that all of
my servers have the same base - the same distribution and, ideally, the
same kernel and patch level - it seemed like a lot of overhead to
duplicate that for multiple VMs. So I started looking into <a href="http://en.wikipedia.org/wiki/Operating_system-level_virtualization"><span class="caps">OS</span>-level
virtualization</a>.
There are relatively few options, and I&#8217;ll admit that aside from Solaris
Containers (which I learned about while working at Sun) I don&#8217;t know
much about it. But <a href="http://www.openvz.org/">OpenVZ</a> seems to be the
front runner in that area. My initial impression was that it made a lot
of sense - keep one common kernel, but allow containers/virtual
environments (CTs/VEs) to have, essentially, their own userland.
Unfortunately, it doesn&#8217;t seem to be as hyped as Xen, and I haven&#8217;t
heard very much about it in the enterprise context. And it requires
running a kernel from the OpenVZ project, which means I can&#8217;t just
script updates through yum as easily as&nbsp;normal.</p>
<p>On the up size, OpenVZ would allow me to eliminate the duplication of
the kernel, and seems to have much less overhead than Xen (and logically
so). On the down side, I lose the ability to virtualize other OSes,
kernel versions, or make pre-packaged VMs. I&#8217;ve decided that if I wanted
to do that, I could dedicate a single&nbsp;machine.</p>
<p>I&#8217;ve spent the last day or so doing a lot of research, and have come up
with the following questions and concerns about OpenVZ which I hope to
be able to answer (I&#8217;ll post the answers in a&nbsp;follow-up).</p>
<ul>
<li>How do I handle distribution and kernel upgrades? The logical
    solution would be to migrate the <span class="caps">CT</span> to another host while I upgrade
    <span class="caps">CT0</span> (the hardware <span class="caps">OS</span>/host/dom0 in Xen speak). But if the guest and
    host kernels must match, how does this&nbsp;work?</li>
<li>Can I do package upgrades within the guest/<span class="caps">CT</span> easily? WIll this play
    well with&nbsp;Puppet?</li>
<li>How will I handle backups? Is it logical to run
    <a href="http://www.bacula.org">bacula</a> within each <span class="caps">CT</span>, or just on <span class="caps">CT0</span>? If
    just on <span class="caps">CT0</span>, how do I easily verify that a particular <span class="caps">CT</span> was backed&nbsp;up?</li>
<li>WIll everything play well with Puppet? (see&nbsp;below)</li>
<li>Am I willing to throw away my KickStart-based installs? And,
    similarly, am I willing to give up the possibility of migrating from
    a container to a Xen host or a physical host&nbsp;(easily)?</li>
<li>OpenVZ live migration relies on rsync. This means that there&#8217;s a
    significant delay (compared to shared storage) and also that I can&#8217;t
    migrate off of a host that&#8217;s down. Is there a way around&nbsp;this?</li>
<li>Similarly, live migration requires root <span class="caps">SSH</span> key exchange
    (passwordless) between the hosts. This seems about equivalent to
    using <code>hosts.equiv</code>. Do I really want root on one box to mean root
    on another box (and all of the containers on that&nbsp;box)?</li>
<li>Can I still firewall <span class="caps">CT0</span>? How will this&nbsp;work?</li>
</ul>
<p>It seems to me that OpenVZ may be significantly less enterprise-class
than Xen. Sure, this is just my home setup, but I hold it to the same
standards I use for my work systems. In fact, I usually test new
technologies at home before I suggest them at work. A lot of the writing
on the <a href="http://wiki.openvz.org/">OpenVZ wiki</a> seems to be riddled with
spelling errors. They claim &#8220;zero downtime&#8221; live migration, but if they
have to rsync 2Gb of MySQL tables, that sounds like a lot more than
&#8220;zero&#8221;. And, most shockingly, the <a href="http://wiki.openvz.org/Hardware_testing">Hardware
testing</a> wiki page talks about
making sure your hosts aren&#8217;t overclocked or undercooled, and running
<code>cpuburn</code> to test your system under high load. Sorry, but the engineers
at <span class="caps">HP</span>, Sun, <span class="caps">IBM</span>, etc. handle that for me and most people I know. So, I&#8217;m
a bit worried about the seriousness of the OpenVZ&nbsp;project.</p>
<p>Most worrisome is a post I found in the <a href="http://forum.openvz.org">OpenVZ
forum</a>, <a href="http://forum.openvz.org/index.php?t=msg&amp;goto=14818&amp;">&#8220;Stopping puppet on hn stops it in all
<span class="caps">VE</span>&#8221;</a>. It seems
that, since <span class="caps">CT0</span> is aware of all of the guest container processes, they
show up in ps lists. Most, if not all RedHat init scripts use killproc
to stop and restart services. This means that a <code>service syslog stop</code> on
the <span class="caps">CT0</span> (host) will stop <strong>all</strong> <code>syslog</code> processes, including all of
them in the CTs. This seems like a major issue. Sure, I could replace
<code>killproc</code> on <span class="caps">CT0</span> with a script that parses the process list, isolates
the PIDs for those running on <span class="caps">CT0</span>, and kills them. But what else needs
to be fixed? Nagios check scripts would need to be adjusted. Is there
anything else that would come back and bite&nbsp;me?</p>
<p>The bottom line is that (I guess this is logical) it seems that
containers in OpenVZ will seem - and act - a lot less like a logical
host than they would under&nbsp;Xen.</p>
            </div>
            <!-- /.entry-content -->
    <hr />
    <!-- Shariff Button BEGIN -->
    <div class="shariff"
        data-lang="en"
        data-orientation="horizontal"
        data-services = "[&quot;facebook&quot;,&quot;googleplus&quot;,&quot;twitter&quot;,&quot;linkedin&quot;,&quot;diaspora&quot;]"
        data-theme="standard"
        data-url="http://blog.jasonantman.com/2010/03/virtualization-options/"></div>
    <!-- Shariff Button END -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'jantman'; // required: replace example with your forum shortname

                    var disqus_identifier = 'virtualization-options';
                var disqus_url = 'http://blog.jasonantman.com/2010/03/virtualization-options/';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Recent Posts -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
  <ul class="list-group" id="recentposts">
    <li class="list-group-item"><a href="http://blog.jasonantman.com/2018/03/diy-raspberry-pi-zero-gps-track-logger/"><span class="caps">DIY</span> Raspberry Pi Zero <span class="caps">GPS</span> Track&nbsp;Logger</a></li>
    <li class="list-group-item"><a href="http://blog.jasonantman.com/2017/10/cloud-custodian-architecture-deployment-and-policy-preprocessing/">Cloud Custodian Architecture, Deployment and Policy&nbsp;Preprocessing</a></li>
    <li class="list-group-item"><a href="http://blog.jasonantman.com/2017/10/pre-authorized-aws-console-urls-for-notifications/">Pre-Authorized <span class="caps">AWS</span> Console URLs for&nbsp;Notifications</a></li>
    <li class="list-group-item"><a href="http://blog.jasonantman.com/2017/04/python-script-to-check-xfinity-data-usage/">Python script to check xfinity data&nbsp;usage</a></li>
    <li class="list-group-item"><a href="http://blog.jasonantman.com/2017/03/vyos-on-alix-2c1-single-board-computer/">VyOS on Alix 2C1 Single Board&nbsp;Computer</a></li>
  </ul>
</li>
<!-- End Sidebar/Recent Posts -->

<!-- Sidebar/Twitter Timeline -->
<li class="list-group-item">
  <h4><i class="fa fa-twitter fa-lg"></i><span class="icon-label">Latest Tweets</span></h4>
  <div id="twitter_timeline">
    <a class="twitter-timeline" data-width="250" data-height="300" data-dnt="true" data-theme="light" href="https://twitter.com/j_antman">Tweets by j_antman</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</li>
<!-- End Sidebar/Twitter Timeline -->

<!-- Sidebar/Github -->
<li class="list-group-item">
  <h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
  <div id="gh_repos">
    <p class="list-group-item">Status updating...</p>
  </div>
  <a href="https://github.com/jantman">@jantman</a> on GitHub
</li>
<!-- End Sidebar/Github -->

<!-- Sidebar/Links -->
<li class="list-group-item">
  <h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
  <ul class="list-group" id="links">
    <li class="list-group-item">
      <a href="http://www.jasonantman.com" target="_blank">Homepage</a>
    </li>
    <li class="list-group-item">
      <a href="http://resume.jasonantman.com" target="_blank">Resume</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Links -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 Jason Antman
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://blog.jasonantman.com/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://blog.jasonantman.com/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://blog.jasonantman.com/theme/js/respond.min.js"></script>



    <!-- GITHUB_REPOS_JSON (explicitly pinned repos ) -->
  <script id="GithubReposJson" type="application/json">
  [{"description": "A script and python module to check your AWS service limits and usage via boto.", "name": "awslimitchecker", "html_url": "https://github.com/jantman/awslimitchecker"}, {"description": "Puppet module and accompanying documentation to install/setup Arch linux on a MacBook Pro Retina 11,4", "name": "puppet-archlinux-macbookretina", "html_url": "https://github.com/jantman/puppet-archlinux-macbookretina"}, {"description": "A collection of my standalone scripts to small/quick for their own repos. All kinds of useful stuff.", "name": "misc-scripts", "html_url": "https://github.com/jantman/misc-scripts"}, {"description": "Responsive Flask/SQLAlchemy personal finance app, specifically for biweekly budgeting.", "name": "biweeklybudget", "html_url": "https://github.com/jantman/biweeklybudget"}, {"description": "Calculate detailed download stats and generate HTML and badges for PyPI packages", "name": "pypi-download-stats", "html_url": "https://github.com/jantman/pypi-download-stats"}, {"description": "A standard to easily communicate to humans and machines the development/support and usability status of software repositories/projects.", "name": "repostatus.org", "html_url": "https://github.com/jantman/repostatus.org"}]
  </script>

<!-- GitHub JS Code -->
<script type="text/javascript">
$(document).ready(function () {
  if (!window.jXHR) {
    var jxhr = document.createElement('script');
    jxhr.type = 'text/javascript';
    jxhr.src = 'http://blog.jasonantman.com/theme/js/jXHR.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(jxhr, s);
  }

  console.log($('#GithubReposJson').html());
  github.showSpecificRepos({
    user: 'jantman',
    target: '#gh_repos',
    repos: JSON.parse($('#GithubReposJson').html())
  });
});
</script>
<script src="http://blog.jasonantman.com/theme/js/github.js" type="text/javascript"></script>
<!-- End GitHub JS Code -->
    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'jantman'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics Universal -->
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-2718127-2', 'jasonantman.com');
        ga('send', 'pageview');
    </script>
    <!-- End Google Analytics Universal Code -->


    <!-- add shariff support -->
    <script src="http://blog.jasonantman.com/theme/js/shariff.min.js"></script>
</body>
</html>