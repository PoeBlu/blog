<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>Wordpress - Automatically publish a pending post each weekday morning from a PHP script</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Open Graph tags -->

    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://blog.jasonantman.com/theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="http://blog.jasonantman.com/theme/css/font-awesome.min.css" rel="stylesheet">
    <link href="http://blog.jasonantman.com/theme/css/pygments.css" rel="stylesheet">
        <link href="http://blog.jasonantman.com/theme/css/typogrify.css" rel="stylesheet">
    <link rel="stylesheet" href="http://blog.jasonantman.com/theme/css/style.css" type="text/css"/>
    <!-- JavaScript plugins (requires jQuery) -->
    <script src="http://code.jquery.com/jquery.js"></script>

    <link rel="stylesheet" href="http://blog.jasonantman.com/theme/css/forkongithub.min.css" type="text/css" />

        <link href="http://blog.jasonantman.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Jason Antman's Blog ATOM Feed"/>
        <link href="http://blog.jasonantman.com/feeds/all.rss.xml" type="application/atom+xml" rel="alternate"
              title="Jason Antman's Blog RSS Feed"/>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2718127-2', 'jasonantman.com');
  ga('send', 'pageview');

</script>
</head>
<body>
<span id="forkongithub"><a href="https://github.com/jantman/blog">Fork me on GitHub</a></span><nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://blog.jasonantman.com" class="navbar-brand">Jason Antman's Blog</a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="http://blog.jasonantman.com/pages/about.html">
                             About
                          </a></li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/ideas-and-rants/index.html">Ideas and rants</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/miscellaneous/index.html">Miscellaneous</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/monitoring/index.html">Monitoring</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/ops/index.html">Ops</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/projects/index.html">Projects</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/puppet/index.html">Puppet</a>
                        </li>
                        <li class="active">
                            <a href="http://blog.jasonantman.com/categories/tech-howtos/index.html">Tech howtos</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://blog.jasonantman.com/archives.html"><i class="icon-th-list"></i>Archives</a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</nav>
<!-- /.navbar -->
<div class="container">
    <div class="row">
        <div class="col-lg-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://blog.jasonantman.com/2012/09/wordpress-automatically-publish-a-pending-post-each-weekday-morning-from-a-php-script/"
                       rel="bookmark"
                       title="Permalink to Wordpress - Automatically publish a pending post each weekday morning from a PHP script">
                        Wordpress - Automatically publish a pending post each weekday morning from a <span class="caps">PHP</span>&nbsp;script
                    </a>
                </h1>
<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="j_antman">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="icon-calendar"></i>Tue 04 September 2012
    </span>



<span class="label label-default">Tags</span>
	<a href="http://blog.jasonantman.com/tags/cron/index.html">cron</a>
        /
	<a href="http://blog.jasonantman.com/tags/php/index.html">PHP</a>
        /
	<a href="http://blog.jasonantman.com/tags/wordpress/index.html">wordpress</a>
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>In an earlier post, <a href="/2012/08/piwik-web-analytics-and-some-unfortunate-stats-about-my-blog/">Piwik Web Analytics, and some unfortunate stats
about my
blog</a>,
I mentioned that the <a href="http://feedburner.google.com/">Feedburner</a> stats
for this blog show a relatively high subscribe/unsubscribe rate for this
blog. I think a large part of that is my tendency to blog in spurts, and
even worse, my tendency to write drafts and not publish them. In an
effort to combat this, I&#8217;ve been trying to finish blog posts and then
set them to &#8220;Pending&#8221; status, and go back and publish one every day
(well, every day that I have some still sitting unpublished). Of course,
that counts on me logging in to Wordpress every day, which isn&#8217;t
something I do. The following script is, at least for now, the answer
for&nbsp;me.</p>
<p>This script (a standalone <span class="caps">PHP</span> script) uses
<a href="http://core.trac.wordpress.org/browser/trunk/wp-load.php"><code>wp-load.php</code></a>
to load the wordpress environment, and then finds the oldest post with a
given status (&#8220;pending&#8221; in my case) and attempts to publish it. It only
does this if there has not been another post published in the last 24
hours. The following script can be found in Git at
<a href="https://github.com/jantman/misc-scripts/blob/master/wordpress_daily_post.php">https://github.com/jantman/misc-scripts/blob/master/wordpress_daily_post.php</a></p>
<!---
sourceinclude
--->

<div class="codehilite"><pre><span class="x">#!/usr/bin/php</span>
<span class="cp">&lt;?php</span>
<span class="sd">/**</span>
<span class="sd"> * wordpress_daily_post.php</span>
<span class="sd"> * Script to publish the oldest post with a given status, if no</span>
<span class="sd"> * other post has been published in 24 hours. Intended to be run</span>
<span class="sd"> * via cron on weekdays.</span>
<span class="sd"> *</span>
<span class="sd"> * Copyright 2012 Jason Antman </span>
<span class="sd"> *</span>
<span class="sd"> * Licensed under the Apache License, Version 2.0 </span>
<span class="sd"> *</span>
<span class="sd"> * use it anywhere you want, however you want, provided that this header is left intact,</span>
<span class="sd"> * and that if redistributed, credit is given to me.</span>
<span class="sd"> *</span>
<span class="sd"> * It is strongly requested, but not technically required, that any changes/improvements</span>
<span class="sd"> * be emailed to the above address.</span>
<span class="sd"> *</span>
<span class="sd"> * The latest version of this script will always be available at:</span>
<span class="sd"> * $HeadURL: http://svn.jasonantman.com/misc-scripts/wordpress_daily_post.php $</span>
<span class="sd"> * $LastChangedRevision: 40 $</span>
<span class="sd"> *</span>
<span class="sd"> * Changelog:</span>
<span class="sd"> * 2012-09-03 Jason Antman  - 1.0</span>
<span class="sd"> *  - first version</span>
<span class="sd"> */</span>

<span class="c1"># <span class="caps">BEGIN</span> <span class="caps">CONFIGURATION</span></span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;WP_LOAD_LOC&#39;</span><span class="p">,</span> <span class="s1">&#39;/var/www/vhosts/blog.jasonantman.com/wp-load.php&#39;</span><span class="p">);</span> <span class="c1">// Configure this to the full path of your Wordpress wp-load.php</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;SOURCE_POST_STATUS&#39;</span><span class="p">,</span> <span class="s1">&#39;pending&#39;</span><span class="p">);</span> <span class="c1">// post status to publish</span>
<span class="c1"># <span class="caps">END</span> <span class="caps">CONFIGURATION</span></span>

<span class="nv">$<span class="caps">VERBOSE</span></span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
<span class="nv">$DRY_RUN</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
<span class="nb">array_shift</span><span class="p">(</span><span class="nv">$argv</span><span class="p">);</span>
<span class="k">while</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-d&quot;</span> <span class="o">||</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;--dry-run&quot;</span><span class="p">){</span>
    <span class="nv">$DRY_RUN</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="nb">fwrite</span><span class="p">(</span><span class="nx"><span class="caps">STDERR</span></span><span class="p">,</span> <span class="s2">&quot;<span class="caps">DRY</span> <span class="caps">RUN</span> <span class="caps">ONLY</span> - <span class="caps">NOT</span> <span class="caps">ACTUALLY</span> <span class="caps">PUBLISHING</span>.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-v&quot;</span> <span class="o">||</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;--verbose&quot;</span><span class="p">){</span>
    <span class="nv">$<span class="caps">VERBOSE</span></span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="nb">fwrite</span><span class="p">(</span><span class="nx"><span class="caps">STDERR</span></span><span class="p">,</span> <span class="s2">&quot;WP_LOAD_LOC=&quot;</span><span class="o">.</span><span class="nx">WP_LOAD_LOC</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="nb">fwrite</span><span class="p">(</span><span class="nx"><span class="caps">STDERR</span></span><span class="p">,</span> <span class="s2">&quot;SOURCE_POST_STATUS=&quot;</span><span class="o">.</span><span class="nx">SOURCE_POST_STATUS</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nb">array_shift</span><span class="p">(</span><span class="nv">$argv</span><span class="p">);</span>
<span class="p">}</span>

<span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_HOST&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span><span class="p">;</span> <span class="c1">// needed for wp-includes/ms-settings.php:100</span>
<span class="k">require_once</span><span class="p">(</span><span class="nx">WP_LOAD_LOC</span><span class="p">);</span>

<span class="c1"># check that we&#39;re running on a weekday</span>
<span class="k">if</span><span class="p">(</span><span class="nb">date</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">#  if($<span class="caps">VERBOSE</span>){ fwrite(<span class="caps">STDERR</span>, &quot;today is a saturday or sunday, dieing.\n&quot;); }</span>
<span class="c1">#  exit(1);</span>
<span class="p">}</span>

<span class="c1"># find the publish date/time of the last published post</span>
<span class="nv">$published</span> <span class="o">=</span> <span class="nx">get_posts</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;numberposts&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;orderby&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;post_date&#39;</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;<span class="caps">DESC</span>&#39;</span><span class="p">,</span> <span class="s1">&#39;post_status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;publish&#39;</span><span class="p">));</span>
<span class="nv">$post</span> <span class="o">=</span> <span class="nv">$published</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="nv">$pub_date</span> <span class="o">=</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">post_date</span><span class="p">;</span>
<span class="nv">$pub_id</span> <span class="o">=</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na"><span class="caps">ID</span></span><span class="p">;</span>

<span class="k">if</span><span class="p">(</span><span class="nb">strtotime</span><span class="p">(</span><span class="nv">$pub_date</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="nb">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">86400</span><span class="p">))</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nv">$<span class="caps">VERBOSE</span></span><span class="p">){</span> <span class="nb">fwrite</span><span class="p">(</span><span class="nx"><span class="caps">STDERR</span></span><span class="p">,</span> <span class="s2">&quot;last post (<span class="caps">ID</span> </span><span class="si">$pub_id</span><span class="s2">) within last day (</span><span class="si">$pub_date</span><span class="s2">). Nothing to do. Exiting.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span> <span class="p">}</span>
  <span class="k">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nv">$<span class="caps">VERBOSE</span></span><span class="p">){</span> <span class="nb">fwrite</span><span class="p">(</span><span class="nx"><span class="caps">STDERR</span></span><span class="p">,</span> <span class="s2">&quot;Found last post (<span class="caps">ID</span> </span><span class="si">$pub_id</span><span class="s2">) with post date </span><span class="si">$pub_date</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>


<span class="c1"># find the earliest post of status SOURCE_POST_STATUS, if there is one.</span>
<span class="nv">$to_post</span> <span class="o">=</span> <span class="nx">get_posts</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;numberposts&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;orderby&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;post_date&#39;</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;<span class="caps">ASC</span>&#39;</span><span class="p">,</span> <span class="s1">&#39;post_status&#39;</span> <span class="o">=&gt;</span> <span class="nx">SOURCE_POST_STATUS</span><span class="p">));</span>
<span class="k">if</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$to_post</span><span class="p">)</span> <span class="nx"><span class="caps">ID</span></span><span class="p">;</span>
<span class="nv">$to_pub_date</span> <span class="o">=</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">post_date</span><span class="p">;</span>
<span class="nv">$to_pub_title</span> <span class="o">=</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">post_title</span><span class="p">;</span>
<span class="nv">$now</span> <span class="o">=</span> <span class="nb">time</span><span class="p">();</span>
<span class="nv">$new_date</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s2">&quot;Y-m-d H:i:s&quot;</span><span class="p">,</span> <span class="nv">$now</span><span class="p">);</span>
<span class="nv">$new_date_gmt</span> <span class="o">=</span> <span class="nb">gmdate</span><span class="p">(</span><span class="s2">&quot;Y-m-d H:i:s&quot;</span><span class="p">,</span> <span class="nv">$now</span><span class="p">);</span>

<span class="k">if</span><span class="p">(</span><span class="nv">$<span class="caps">VERBOSE</span></span><span class="p">){</span> <span class="nb">fwrite</span><span class="p">(</span><span class="nx"><span class="caps">STDERR</span></span><span class="p">,</span> <span class="s2">&quot;Post to publish: <span class="caps">ID</span>=</span><span class="si">$to_pub_id</span><span class="s2"> <span class="caps">DATE</span>=</span><span class="si">$to_pub_date</span><span class="s2"> NEW_DATE=</span><span class="si">$new_date</span><span class="s2"> <span class="caps">TITLE</span>=</span><span class="si">$to_pub_title</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span> <span class="p">}</span>

<span class="c1"># actually publish it</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span> <span class="nv">$DRY_RUN</span><span class="p">){</span>
  <span class="nv">$arr</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;<span class="caps">ID</span>&#39;</span> <span class="o">=&gt;</span> <span class="nv">$to_pub_id</span><span class="p">,</span> <span class="s1">&#39;post_status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;publish&#39;</span><span class="p">,</span> <span class="s1">&#39;post_date&#39;</span> <span class="o">=&gt;</span> <span class="nv">$new_date</span><span class="p">,</span> <span class="s1">&#39;post_date_gmt&#39;</span> <span class="o">=&gt;</span> <span class="nv">$new_date_gmt</span><span class="p">);</span>
  <span class="nv">$ret</span> <span class="o">=</span> <span class="nx">wp_update_post</span><span class="p">(</span><span class="nv">$arr</span><span class="p">);</span> <span class="c1">// publish the post</span>
  <span class="k">if</span><span class="p">(</span><span class="nv">$ret</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">fwrite</span><span class="p">(</span><span class="nx"><span class="caps">STDERR</span></span><span class="p">,</span> <span class="s2">&quot;<span class="caps">ERROR</span>: Post </span><span class="si">$to_pub_id</span><span class="s2"> was not successfully published.&quot;</span><span class="p">);</span>
    <span class="k">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span><span class="p">(</span><span class="nv">$<span class="caps">VERBOSE</span></span><span class="p">){</span> <span class="nb">fwrite</span><span class="p">(</span><span class="nx"><span class="caps">STDERR</span></span><span class="p">,</span> <span class="s2">&quot;Published post. New <span class="caps">ID</span>: </span><span class="si">$ret</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="nb">fwrite</span><span class="p">(</span><span class="nx"><span class="caps">STDERR</span></span><span class="p">,</span> <span class="s2">&quot;Dry run only, not publishing post.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1"># check that the post really was published</span>
<span class="nv">$published</span> <span class="o">=</span> <span class="nx">get_posts</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;numberposts&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;orderby&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;post_date&#39;</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;<span class="caps">DESC</span>&#39;</span><span class="p">,</span> <span class="s1">&#39;post_status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;publish&#39;</span><span class="p">));</span>
<span class="nv">$post</span> <span class="o">=</span> <span class="nv">$published</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="nv">$pub_date</span> <span class="o">=</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">post_date</span><span class="p">;</span>
<span class="nv">$pub_id</span> <span class="o">=</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na"><span class="caps">ID</span></span><span class="p">;</span>
<span class="nv">$pub_title</span> <span class="o">=</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">post_title</span><span class="p">;</span>
<span class="nv">$pub_guid</span> <span class="o">=</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">guid</span><span class="p">;</span>

<span class="k">if</span><span class="p">(</span><span class="nv">$pub_title</span> <span class="o">!=</span> <span class="nv">$to_pub_title</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">fwrite</span><span class="p">(</span><span class="nx"><span class="caps">STDERR</span></span><span class="p">,</span> <span class="s2">&quot;<span class="caps">ERROR</span>: title of most recent post does not match title of what we wanted to post.&quot;</span><span class="p">);</span>
  <span class="k">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="nb">fwrite</span><span class="p">(</span><span class="nx"><span class="caps">STDOUT</span></span><span class="p">,</span> <span class="s2">&quot;Published post </span><span class="si">$pub_id</span><span class="s2"> at </span><span class="si">$pub_date</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="nb">fwrite</span><span class="p">(</span><span class="nx"><span class="caps">STDOUT</span></span><span class="p">,</span> <span class="s2">&quot;Title: </span><span class="si">$pub_title</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="nb">fwrite</span><span class="p">(</span><span class="nx"><span class="caps">STDOUT</span></span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2"> <span class="caps">GUID</span>/Link: </span><span class="si">$pub_guid</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="nb">fwrite</span><span class="p">(</span><span class="nx"><span class="caps">STDOUT</span></span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="k">__FILE__</span><span class="o">.</span><span class="s2">&quot; on &quot;</span><span class="o">.</span><span class="nx">trim</span><span class="p">(</span><span class="nb">shell_exec</span><span class="p">(</span><span class="s1">&#39;hostname --fqdn&#39;</span><span class="p">))</span><span class="o">.</span><span class="s2">&quot; running as &quot;</span><span class="o">.</span><span class="nb">get_current_user</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>


<p>You&#8217;ll need to set <code>WP_LOAD_LOC</code> (line 29) to the full path of your
Wordpress installation&#8217;s <code>wp-load.php</code> (it should be in the top-level
directory of your Wordpress installation. I run this script from cron&nbsp;like:</p>
<div class="codehilite"><pre>0 6 * * 1-5 /home/jantman/bin/wordpress_daily_post.php --verbose # publish WP pending posts daily
</pre></div>


<p>so that it runs at <span class="caps">6AM</span> (local time) each weekday. Assuming you have cron
setup to send you mail, you&#8217;ll get a daily message saying what was (or
wasn&#8217;t)&nbsp;done.</p>
            </div>
            <!-- /.entry-content -->
    <hr />
    <section class="comments" id="comments">
        <h2>Comments</h2>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'jasonantman'; // required: replace example with your forum shortname
            var disqus_identifier = 'wordpress-automatically-publish-a-pending-post-each-weekday-morning-from-a-php-script';
            var disqus_url = 'http://blog.jasonantman.com/2012/09/wordpress-automatically-publish-a-pending-post-each-weekday-morning-from-a-php-script/';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-lg-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">

                <li class="list-group-item"><h4><i class="icon-home icon-large"></i>Recent Posts</h4></li>
                        <li class="list-group-item">
                            <a href="http://blog.jasonantman.com/2014/03/blog-moved-from-self-hosted-wordpress-to-pelican-on-github-pages/">
                                Blog Moved from Self-hosted WordPress to Pelican on GitHub&nbsp;Pages
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://blog.jasonantman.com/2014/03/wordpress-to-pelican-with-disqus-comments/">
                                Wordpress to Pelican with Disqus&nbsp;comments
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://blog.jasonantman.com/2014/02/converting-wordpress-posts-to-pelican-markdown/">
                                Converting WordPress Posts to Pelican&nbsp;MarkDown
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://blog.jasonantman.com/2014/01/planning-migration-from-wordpress-to-static-site/">
                                Planning Migration from WordPress to Static&nbsp;Site
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://blog.jasonantman.com/2013/08/testing-gpg-key-passphrases/">
                                Testing <span class="caps">GPG</span> Key&nbsp;Passphrases
                            </a>
                        </li>


                <li class="list-group-item"><a href="http://blog.jasonantman.com/tags.html"><h4><i class="icon-tags icon-large"></i>Tags</h4></a></li>
                <li class="list-group-item">
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/sun/index.html">
                                sun
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/google/index.html">
                                google
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/microsoft/index.html">
                                microsoft
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/puppet/index.html">
                                puppet
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/php/index.html">
                                PHP
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/blog/index.html">
                                blog
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/linux/index.html">
                                linux
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/wordpress/index.html">
                                wordpress
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/android/index.html">
                                android
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/monitoring/index.html">
                                monitoring
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/nagios/index.html">
                                Nagios
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/sysadmin/index.html">
                                sysadmin
                            </a>
                        </span>
                        <span class="tag-2">
                            <a href="http://blog.jasonantman.com/tags/mediawiki/index.html">
                                mediawiki
                            </a>
                        </span>
                        <span class="tag-2">
                            <a href="http://blog.jasonantman.com/tags/security/index.html">
                                security
                            </a>
                        </span>
                        <span class="tag-2">
                            <a href="http://blog.jasonantman.com/tags/droid/index.html">
                                droid
                            </a>
                        </span>
                        <span class="tag-2">
                            <a href="http://blog.jasonantman.com/tags/firefox/index.html">
                                firefox
                            </a>
                        </span>
                        <span class="tag-2">
                            <a href="http://blog.jasonantman.com/tags/apache/index.html">
                                apache
                            </a>
                        </span>
                        <span class="tag-2">
                            <a href="http://blog.jasonantman.com/tags/dns/index.html">
                                dns
                            </a>
                        </span>
                        <span class="tag-2">
                            <a href="http://blog.jasonantman.com/tags/syslog/index.html">
                                syslog
                            </a>
                        </span>
                        <span class="tag-2">
                            <a href="http://blog.jasonantman.com/tags/logging/index.html">
                                logging
                            </a>
                        </span>
                </li>
        </ul>
    </section>
    <section>
    <ul class="list-group list-group-flush">
    <li class="list-group-item" style="padding: 10px 15px 0px 15px;"><h4><i class="icon-twitter
    icon-large"></i>Twitter <a href="https://twitter.com/j_antman"
    class="twitter-follow-button" data-show-count="false"
    data-dnt="true">Follow @j_antman</a></h4>
<script>!function(d,s,id){var
  js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document,
  'script', 'twitter-wjs');</script></li>
    </ul>
    <a class="twitter-timeline" data-dnt="true"
    href="https://twitter.com/j_antman"
    data-chrome="transparent noheader" data-widget-id="429640274453594113">Tweets by @j_antman</a>
    <script>!function(d,s,id){var
    js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </section>
    <section>
    <ul class="list-group list-group-flush">
    <li class="list-group-item"><h4><i class="icon-github icon-large"></i>GitHub Repos</h4></li>
        <div id="gh_repos">
            <p class="list-group-item">Status updating...</p>
        </div>
            <a href="https://github.com/jantman">@jantman</a> on GitHub
    </ul>
        <script type="text/javascript">
            $(document).ready(function () {
                if (!window.jXHR) {
                    var jxhr = document.createElement('script');
                    jxhr.type = 'text/javascript';
                    jxhr.src = 'http://blog.jasonantman.com/theme/js/jXHR.js';
                    var s = document.getElementsByTagName('script')[0];
                    s.parentNode.insertBefore(jxhr, s);
                }

                github.showRepos({
                    user: 'jantman',
                    count: 5,
                    skip_forks: false,
                    target: '#gh_repos'
                });
            });
        </script>
        <script src="http://blog.jasonantman.com/theme/js/github.js" type="text/javascript"></script>
    </section>
</aside>        </div>
    </div>
</div>
<footer>
    <div class="container">
        <hr>
        <p class="pull-right"><i class="icon-arrow-up"></i> <a href="#">Back to top</a></p>


        <p>&copy; 2014 Jason Antman &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a></p>
    </div>
</footer>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://blog.jasonantman.com/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://blog.jasonantman.com/theme/js/respond.min.js"></script>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'jasonantman'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>


</body>
</html>