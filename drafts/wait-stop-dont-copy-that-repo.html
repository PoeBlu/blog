<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>Wait! Stop! Don’t copy that repo!</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Open Graph tags -->

    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://blog.jasonantman.com/theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="http://blog.jasonantman.com/theme/css/font-awesome.min.css" rel="stylesheet">
    <link href="http://blog.jasonantman.com/theme/css/pygments.css" rel="stylesheet">
        <link href="http://blog.jasonantman.com/theme/css/typogrify.css" rel="stylesheet">
    <link rel="stylesheet" href="http://blog.jasonantman.com/theme/css/style.css" type="text/css"/>
    <!-- JavaScript plugins (requires jQuery) -->
    <script src="http://code.jquery.com/jquery.js"></script>

    <link rel="stylesheet" href="http://blog.jasonantman.com/theme/css/forkongithub.min.css" type="text/css" />

        <link href="http://blog.jasonantman.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Jason Antman's Blog ATOM Feed"/>
        <link href="http://blog.jasonantman.com/feeds/all.rss.xml" type="application/atom+xml" rel="alternate"
              title="Jason Antman's Blog RSS Feed"/>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2718127-2', 'jasonantman.com');
  ga('send', 'pageview');

</script>
</head>
<body>
<span id="forkongithub"><a href="https://github.com/jantman/blog">Fork me on GitHub</a></span><nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://blog.jasonantman.com" class="navbar-brand">Jason Antman's Blog</a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="http://blog.jasonantman.com/pages/about.html">
                             About
                          </a></li>
                        <li class="active">
                            <a href="http://blog.jasonantman.com/categories/ideas-and-rants/index.html">Ideas and rants</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/miscellaneous/index.html">Miscellaneous</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/monitoring/index.html">Monitoring</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/ops/index.html">Ops</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/projects/index.html">Projects</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/puppet/index.html">Puppet</a>
                        </li>
                        <li >
                            <a href="http://blog.jasonantman.com/categories/tech-howtos/index.html">Tech howtos</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://blog.jasonantman.com/archives.html"><i class="icon-th-list"></i>Archives</a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</nav>
<!-- /.navbar -->
<div class="container">
    <div class="row">
        <div class="col-lg-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://blog.jasonantman.com/2016/04/wait-stop-dont-copy-that-repo/"
                       rel="bookmark"
                       title="Permalink to Wait! Stop! Don’t copy that repo!">
                        Wait! Stop! Don&#8217;t copy that&nbsp;repo!
                    </a>
                </h1>
<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="j_antman">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="icon-calendar"></i>Sun 03 April 2016
    </span>



<span class="label label-default">Tags</span>
	<a href="http://blog.jasonantman.com/tags/clone/index.html">clone</a>
        /
	<a href="http://blog.jasonantman.com/tags/fork/index.html">fork</a>
        /
	<a href="http://blog.jasonantman.com/tags/repository/index.html">repository</a>
        /
	<a href="http://blog.jasonantman.com/tags/code/index.html">code</a>
        /
	<a href="http://blog.jasonantman.com/tags/management/index.html">management</a>
        /
	<a href="http://blog.jasonantman.com/tags/versiong/index.html">versiong</a>
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Once upon a time, I worked at a company with some of the most talented and passionate people I&#8217;ve ever known. We
were a shop that used almost all open-source software, and ran a <span class="caps">CMS</span> that powered a whole bunch of relatively
large sites, as well as working some related and unrelated smaller projects. The language that we used isn&#8217;t
important; it was an interpreted language with a well-supported packaging system. Most packages lived in Git,
often open source on GitHub, and we also maintained an internal package repository compatible with the language&#8217;s&nbsp;tooling.</p>
<p>In the last few months of my tenure there, on their Automation team, I was tasked with migrating from a legacy
internal git server to a new GitLab instance. I&#8217;d thought that the hardest part would be coordinating time for
a cutover from the old server to the new one, and ensuring that all changes were synced over. That was incredibly
far from the&nbsp;case.</p>
<p>As I started to examine the repositories on the old server, I was dumbfounded. I&#8217;d expected that our internal projects
would be a bit of a mess. What I wasn&#8217;t prepared for, though, was the state of our external dependencies. In some cases,
we had as many as six internal repositories that all were named like widely-available open source packages for our
language, often hosted on GitHub. There would be a &#8220;foo&#8221;, &#8220;foo-old&#8221;, &#8220;foo-new&#8221;, &#8220;foo-<companyname>&#8221; and another &#8220;foo&#8221;
or two under different directories (we managed them somewhat like namespaces/organizations in GitHub and GitLab).
Some of them were actual clones of the original repository with local modifications, but some of them were archives
or exports, with none of the upstream history. Some of them had many local modifications yet retained the upstream
version; some had the version numbers properly identified as a fork, according to the language spec; others simply
continued incrementing the version number with local&nbsp;changes.</p>
<p>I spent almost three weeks trying to reconcile various repositories with both the upstream source and our running
code. In some instances, we&#8217;d submitted our changes back to the upstream project, had them accepted, and just never
switched back to the public version. In most cases, we&#8217;d never submitted our changes, and were now horribly diverged
from upstream; we&#8217;d had more than a few bugs that resulted in developers spending days or weeks trying to reconcile
years of work in order to pull in upstream bug fixes. In a number of cases, the built packages in our internal
package server didn&#8217;t match up with <em>any</em> commit or tag in <em>any</em> of the source&nbsp;repositories.</p>
<p>A few weeks ago, at my new job, we&#8217;d made some fixes that we needed to an open source project. In a meeting, there
was a quick discussion about how to handle them, and the suggestions ranged from opening a pull request to forking
the project (on GitHub) to simply copying it to our internal git server. Perhaps a bit too forcefully, I interjected,
&#8220;Wait! <strong>Stop!</strong> Do <strong>not</strong> copy that to the private&nbsp;server!&#8221;</p>
<p>I&#8217;ve seen many, many examples of this being done: public, open source projects&nbsp;being </p>
<h2 id="why">Why?</h2>
<ul>
<li>cost of&nbsp;maintenance/overhead</li>
<li>unless you&#8217;re going to seriously commit to maintenance in the long term, upstream <em>will</em> fix bugs that you&nbsp;haven&#8217;t</li>
<li>the future / the long&nbsp;view</li>
<li>giving&nbsp;back</li>
<li>testing - many&nbsp;eyes</li>
<li>upgrading your&nbsp;software</li>
</ul>
<h2 id="a-call-to-action">A Call To&nbsp;Action</h2>
<ul>
<li>fork <span class="amp">&amp;</span> <span class="caps">PR</span>, work off your fork if need&nbsp;be</li>
<li>versioning or naming to show this&nbsp;(links?)</li>
<li>vendor it&nbsp;in?</li>
</ul>
<h2 id="so-the-suits-wont-let-you">So, The Suits Won&#8217;t Let&nbsp;You</h2>
<p>I know it&#8217;s not uncommon in certain industries for companies to have issues releasing work under open source
licenses. If that&#8217;s the case, I do have a set of recommendations. Please note that I&#8217;m not a lawyer; some of
what I suggest may be ill-advised for many people, so please take this with a grain of salt and be sure to
do what&#8217;s legal and&nbsp;ethical.</p>
<ol>
<li>See if your company&#8217;s hostility to open source is actually real, or just a conspiracy theory. Just because
everyone says it can&#8217;t happen, doesn&#8217;t mean that&#8217;s fact. Ask your manager, and get it escalated as high up the
chain as it can. Even if it doesn&#8217;t work for the specific project in question, it could help in the&nbsp;future.</li>
<li>Do it on your own time. I know different companies have different policies on this, but I&#8217;ve worked places
where it was perfectly clear that anything I did outside my work hours was my own. If it&#8217;s a quick fix, why not
whip it up at home and try to get the pull request or patch&nbsp;accepted?</li>
<li>Many companies that aren&#8217;t willing to release their own code/projects under an open source license might
feel differently about something that&#8217;s just a patch to existing software. Ask about this specifically; if
it&#8217;s just a few dozen or hundred lines that are already written and fix a problem in an <span class="caps">OSS</span> package, they
might be more willing to allow&nbsp;it.</li>
<li>If it&#8217;s legally and ethically advisable, perhaps you can just email your patch to a maintainer of the
project, and explain that you can&#8217;t fork or submit through the official methods, but you want to give&nbsp;back.</li>
<li>If all of the above fail or aren&#8217;t practical, make sure you&#8217;ve submitted the best bug report you can. The
more detail you give - and the more help you can be in suggesting a possible solution and doing as much of
the leg work as you can - the better. I&#8217;m always happy to receive a bug report that explains the exact failure
case, provides pointers to the source code in question, and suggests a&nbsp;solution.</li>
<li>Ok, so all of those things failed or weren&#8217;t feasible, and you need to maintain a private internal version
of the project. For your own sanity and that of the people who come after you, here are some tips:<ol>
<li>Resist the impulse to simply copy/archive/export the upstream source. Do an actual git clone of it,
and get all of that history pulled in to your internal repository. It will make it clear when you
began internal development, and it will make it possible to merge in future upstream changes without
spending large amounts of time trying to figure out when the repositories diverged. You&#8217;ll be able to
rebase and merge the way you would with any git&nbsp;repository.</li>
<li>Don&#8217;t work on <code>master</code>. Set a new default branch to be something like <code>internal</code>. Keep all of
the upstream branches, and use your own. The goal is to keep as much transparency as possible about
when the project was brought internal, and what work/code is internal vs upstream. Do everything you
can to make this clear, especially to people who join the company months or years&nbsp;later.</li>
<li>Tag the state of <code>master</code> when you bring the repository internal, with a descriptive tag like
<code>point-of-divergence</code>. When you pull master and then rebase upstream changes into your internal
branch (which you <em>will</em> want or need to do at some point), update the tag. The goal is to be able
to easily tell at any time (using native git tooling) what work is internal vs upstream, and how
far behind upstream you&nbsp;are.</li>
<li>Periodically monitor the state of upstream. The goal of all this is to reduce the overhead of
maintaining software - especially third-party projects that are dependencies - as much as possible.
Clarity of what work is internal vs external is good. Even better is being able to switch back to
the official upstream when your bug is fixed. Monitor releases periodically, and test any possible
fixes for your bug or feature. If one works, switch back to upstream and delete your internal&nbsp;repository.</li>
<li>Document all of this clearly. Update the <span class="caps">README</span> in your local default branch with an explanation
of when and why the internal repo was created, what conditions need to be met to switch back to the
upstream, and how branching, tagging and rebasing on upstream&nbsp;work.</li>
<li>Finally, and I can&#8217;t stress this enough, resist the impulse to add whatever you want to the internal
version of the project just because it exists. Have all code changes reviewed not only for quality,
but for whether or not they belong there. If you&#8217;re adding organization-specific logic to a third-party
library, you&#8217;re probably doing it wrong, and you&#8217;re preventing yourself from ever benefiting from
upstream bug fixes or being able to return to the public version. See my notes above on this&nbsp;topic.</li>
</ol>
</li>
</ol>
<p>I hope some of this prevents others from having to go through as much pain reconciling internal/forked
versions of projects as I&nbsp;did.</p>
            </div>
            <!-- /.entry-content -->
    <hr />
    <section class="comments" id="comments">
        <h2>Comments</h2>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'jantman'; // required: replace example with your forum shortname
            var disqus_identifier = 'wait-stop-dont-copy-that-repo';
            var disqus_url = 'http://blog.jasonantman.com/2016/04/wait-stop-dont-copy-that-repo/';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-lg-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">

                <li class="list-group-item"><h4><i class="icon-home icon-large"></i>Recent Posts</h4></li>
                        <li class="list-group-item">
                            <a href="http://blog.jasonantman.com/2016/08/openssh-changing-hostnames-based-on-location/">
                                OpenSSH changing hostnames based on&nbsp;location
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://blog.jasonantman.com/2016/08/tooling-for-aws-webhooks-to-sqs-via-api-gateway-and-lambda/">
                                Tooling for <span class="caps">AWS</span> - webhooks to <span class="caps">SQS</span> via <span class="caps">API</span> Gateway and&nbsp;Lambda
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://blog.jasonantman.com/2016/06/a-short-comment-on-gun-rights-in-america/">
                                A Short Comment on Gun Rights in&nbsp;America
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://blog.jasonantman.com/2016/04/terraform-shortcomings-no-interpolated-default-values-no-functions/">
                                Terraform Shortcomings - No Interpolated Default Values, No Functions, No Conditionals, Local State&nbsp;Storage
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://blog.jasonantman.com/2016/01/raspberry-pi-security-system/">
                                Raspberry Pi Security&nbsp;System
                            </a>
                        </li>


                <li class="list-group-item"><a href="http://blog.jasonantman.com/tags.html"><h4><i class="icon-tags icon-large"></i>Tags</h4></a></li>
                <li class="list-group-item">
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/php/index.html">
                                PHP
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/monitoring/index.html">
                                monitoring
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/puppet/index.html">
                                puppet
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/microsoft/index.html">
                                microsoft
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/security/index.html">
                                security
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/python/index.html">
                                python
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/blog/index.html">
                                blog
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/google/index.html">
                                google
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/sun/index.html">
                                sun
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/android/index.html">
                                android
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/nagios/index.html">
                                Nagios
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/wordpress/index.html">
                                wordpress
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/linux/index.html">
                                linux
                            </a>
                        </span>
                        <span class="tag-1">
                            <a href="http://blog.jasonantman.com/tags/sysadmin/index.html">
                                sysadmin
                            </a>
                        </span>
                        <span class="tag-2">
                            <a href="http://blog.jasonantman.com/tags/syslog/index.html">
                                syslog
                            </a>
                        </span>
                        <span class="tag-2">
                            <a href="http://blog.jasonantman.com/tags/firefox/index.html">
                                firefox
                            </a>
                        </span>
                        <span class="tag-2">
                            <a href="http://blog.jasonantman.com/tags/droid/index.html">
                                droid
                            </a>
                        </span>
                        <span class="tag-2">
                            <a href="http://blog.jasonantman.com/tags/dns/index.html">
                                dns
                            </a>
                        </span>
                        <span class="tag-2">
                            <a href="http://blog.jasonantman.com/tags/rpm/index.html">
                                rpm
                            </a>
                        </span>
                        <span class="tag-2">
                            <a href="http://blog.jasonantman.com/tags/apache/index.html">
                                apache
                            </a>
                        </span>
                </li>
        </ul>
    </section>
    <section>
    <ul class="list-group list-group-flush">
    <li class="list-group-item" style="padding: 10px 15px 0px 15px;"><h4><i class="icon-twitter
    icon-large"></i>Twitter <a href="https://twitter.com/j_antman"
    class="twitter-follow-button" data-show-count="false"
    data-dnt="true">Follow @j_antman</a></h4>
<script>!function(d,s,id){var
  js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document,
  'script', 'twitter-wjs');</script></li>
    </ul>
    <a class="twitter-timeline" data-dnt="true"
    href="https://twitter.com/j_antman"
    data-chrome="transparent noheader" data-widget-id="429640274453594113">Tweets by @j_antman</a>
    <script>!function(d,s,id){var
    js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </section>
    <section>
    <ul class="list-group list-group-flush">
    <li class="list-group-item"><h4><i class="icon-github icon-large"></i>GitHub Repos</h4></li>
        <div id="gh_repos">
            <p class="list-group-item">Status updating...</p>
        </div>
            <a href="https://github.com/jantman">@jantman</a> on GitHub
    </ul>
        <script type="text/javascript">
            $(document).ready(function () {
                if (!window.jXHR) {
                    var jxhr = document.createElement('script');
                    jxhr.type = 'text/javascript';
                    jxhr.src = 'http://blog.jasonantman.com/theme/js/jXHR.js';
                    var s = document.getElementsByTagName('script')[0];
                    s.parentNode.insertBefore(jxhr, s);
                }

                github.showRepos({
                    user: 'jantman',
                    count: 5,
                    skip_forks: false,
                    target: '#gh_repos'
                });
            });
        </script>
        <script src="http://blog.jasonantman.com/theme/js/github.js" type="text/javascript"></script>
    </section>
</aside>        </div>
    </div>
</div>
<footer>
    <div class="container">
        <hr>
        <p class="pull-right"><i class="icon-arrow-up"></i> <a href="#">Back to top</a></p>


        <p>&copy; 2016 Jason Antman &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a></p>
    </div>
</footer>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://blog.jasonantman.com/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://blog.jasonantman.com/theme/js/respond.min.js"></script>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'jantman'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>


</body>
</html>